"use strict";(self.webpackChunkmy_docs=self.webpackChunkmy_docs||[]).push([[5122],{2327:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"nyxc","title":"12. NyxClient - gRPC\u5ba2\u6237\u7aef","description":"12.1 \u6982\u8ff0","source":"@site/docs/12-nyxc.md","sourceDirName":".","slug":"/nyxc","permalink":"/docs/nyxc","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/12-nyxc.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"11. \u4e2d\u95f4\u4ef6\u7cfb\u7edf","permalink":"/docs/middleware"},"next":{"title":"13. X \u5de5\u5177\u96c6","permalink":"/docs/x-utilities"}}');var i=r(4848),l=r(8453);const t={},c="12. NyxClient - gRPC\u5ba2\u6237\u7aef",a={},o=[{value:"12.1 \u6982\u8ff0",id:"121-\u6982\u8ff0",level:2},{value:"12.2 \u6838\u5fc3\u67b6\u6784",id:"122-\u6838\u5fc3\u67b6\u6784",level:2},{value:"12.2.1 \u5ba2\u6237\u7aef\u6838\u5fc3 (NyxClient)",id:"1221-\u5ba2\u6237\u7aef\u6838\u5fc3-nyxclient",level:3},{value:"12.2.2 \u8fde\u63a5\u6c60\u7ba1\u7406 (RpcPool)",id:"1222-\u8fde\u63a5\u6c60\u7ba1\u7406-rpcpool",level:3},{value:"12.2.3 \u54cd\u5e94\u5904\u7406 (Response &amp; ResponseIter)",id:"1223-\u54cd\u5e94\u5904\u7406-response--responseiter",level:3},{value:"12.3 \u5ba2\u6237\u7aef\u521d\u59cb\u5316",id:"123-\u5ba2\u6237\u7aef\u521d\u59cb\u5316",level:2},{value:"12.3.1 \u57fa\u672c\u521d\u59cb\u5316",id:"1231-\u57fa\u672c\u521d\u59cb\u5316",level:3},{value:"12.3.2 \u81ea\u5b9a\u4e49\u914d\u7f6e",id:"1232-\u81ea\u5b9a\u4e49\u914d\u7f6e",level:3},{value:"12.4 \u8fde\u63a5\u6c60\u914d\u7f6e",id:"124-\u8fde\u63a5\u6c60\u914d\u7f6e",level:2},{value:"12.4.1 \u7a7a\u95f2\u8fde\u63a5\u7ba1\u7406",id:"1241-\u7a7a\u95f2\u8fde\u63a5\u7ba1\u7406",level:3},{value:"12.4.2 \u8fde\u63a5\u8d85\u65f6\u914d\u7f6e",id:"1242-\u8fde\u63a5\u8d85\u65f6\u914d\u7f6e",level:3},{value:"12.5 \u7f13\u5b58\u673a\u5236",id:"125-\u7f13\u5b58\u673a\u5236",level:2},{value:"12.5.1 \u542f\u7528\u7f13\u5b58",id:"1251-\u542f\u7528\u7f13\u5b58",level:3},{value:"12.5.2 \u81ea\u5b9a\u4e49\u7f13\u5b58\u5927\u5c0f",id:"1252-\u81ea\u5b9a\u4e49\u7f13\u5b58\u5927\u5c0f",level:3},{value:"12.5.3 \u8bf7\u6c42\u7ea7\u7f13\u5b58\u914d\u7f6e",id:"1253-\u8bf7\u6c42\u7ea7\u7f13\u5b58\u914d\u7f6e",level:3},{value:"12.5.3.1 \u56fa\u5b9aTTL\u7f13\u5b58",id:"12531-\u56fa\u5b9attl\u7f13\u5b58",level:4},{value:"12.5.3.2 \u81ea\u52a8\u5237\u65b0\u7f13\u5b58",id:"12532-\u81ea\u52a8\u5237\u65b0\u7f13\u5b58",level:4},{value:"12.5.3.3 \u7f13\u5b58\u56de\u8c03\u51fd\u6570",id:"12533-\u7f13\u5b58\u56de\u8c03\u51fd\u6570",level:4},{value:"12.5.4 \u7f13\u5b58\u5de5\u4f5c\u539f\u7406",id:"1254-\u7f13\u5b58\u5de5\u4f5c\u539f\u7406",level:3},{value:"12.5.5 \u68c0\u67e5\u7f13\u5b58\u72b6\u6001",id:"1255-\u68c0\u67e5\u7f13\u5b58\u72b6\u6001",level:3},{value:"12.6 \u8bf7\u6c42\u5904\u7406",id:"126-\u8bf7\u6c42\u5904\u7406",level:2},{value:"12.6.1 \u540c\u6b65\u8bf7\u6c42",id:"1261-\u540c\u6b65\u8bf7\u6c42",level:3},{value:"12.6.2 \u6d41\u5f0f\u8bf7\u6c42",id:"1262-\u6d41\u5f0f\u8bf7\u6c42",level:3},{value:"12.6.3 \u8bf7\u6c42\u53c2\u6570\u5904\u7406",id:"1263-\u8bf7\u6c42\u53c2\u6570\u5904\u7406",level:3},{value:"12.7 \u8bf7\u6c42\u9009\u9879\u914d\u7f6e",id:"127-\u8bf7\u6c42\u9009\u9879\u914d\u7f6e",level:2},{value:"12.7.1 \u8d85\u65f6\u914d\u7f6e",id:"1271-\u8d85\u65f6\u914d\u7f6e",level:3},{value:"12.7.2 \u4e0a\u4e0b\u6587\u4f20\u9012",id:"1272-\u4e0a\u4e0b\u6587\u4f20\u9012",level:3},{value:"12.7.3 \u81ea\u5b9a\u4e49\u5934\u90e8\u4fe1\u606f",id:"1273-\u81ea\u5b9a\u4e49\u5934\u90e8\u4fe1\u606f",level:3},{value:"12.8 \u8ba4\u8bc1\u673a\u5236",id:"128-\u8ba4\u8bc1\u673a\u5236",level:2},{value:"12.8.1 \u9ed8\u8ba4\u8ba4\u8bc1",id:"1281-\u9ed8\u8ba4\u8ba4\u8bc1",level:3},{value:"12.8.2 \u81ea\u5b9a\u4e49\u8ba4\u8bc1\u51fd\u6570",id:"1282-\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u51fd\u6570",level:3},{value:"12.9 \u9519\u8bef\u5904\u7406",id:"129-\u9519\u8bef\u5904\u7406",level:2},{value:"12.9.1 \u7f51\u7edc\u9519\u8bef\u5904\u7406",id:"1291-\u7f51\u7edc\u9519\u8bef\u5904\u7406",level:3},{value:"12.9.2 \u4e1a\u52a1\u9519\u8bef\u5904\u7406",id:"1292-\u4e1a\u52a1\u9519\u8bef\u5904\u7406",level:3},{value:"12.9.3 \u6d41\u5f0f\u8bf7\u6c42\u9519\u8bef\u5904\u7406",id:"1293-\u6d41\u5f0f\u8bf7\u6c42\u9519\u8bef\u5904\u7406",level:3},{value:"12.10 \u65e5\u5fd7\u8bb0\u5f55",id:"1210-\u65e5\u5fd7\u8bb0\u5f55",level:2},{value:"12.10.1 \u65e5\u5fd7\u7ea7\u522b\u548c\u8f93\u51fa",id:"12101-\u65e5\u5fd7\u7ea7\u522b\u548c\u8f93\u51fa",level:3},{value:"12.10.2 \u542f\u7528\u8c03\u8bd5\u6a21\u5f0f",id:"12102-\u542f\u7528\u8c03\u8bd5\u6a21\u5f0f",level:3},{value:"12.10.3 \u65e5\u5fd7\u6587\u4ef6",id:"12103-\u65e5\u5fd7\u6587\u4ef6",level:3},{value:"12.10.4 \u96c6\u6210 Nyx \u6846\u67b6\u65e5\u5fd7",id:"12104-\u96c6\u6210-nyx-\u6846\u67b6\u65e5\u5fd7",level:3},{value:"12.11 \u6027\u80fd\u4f18\u5316",id:"1211-\u6027\u80fd\u4f18\u5316",level:2},{value:"12.11.1 \u8fde\u63a5\u6c60\u4f18\u5316",id:"12111-\u8fde\u63a5\u6c60\u4f18\u5316",level:3},{value:"12.11.2 \u7f13\u5b58\u7b56\u7565",id:"12112-\u7f13\u5b58\u7b56\u7565",level:3},{value:"12.11.3 \u5e76\u53d1\u8bf7\u6c42",id:"12113-\u5e76\u53d1\u8bf7\u6c42",level:3},{value:"12.12 \u6700\u4f73\u5b9e\u8df5",id:"1212-\u6700\u4f73\u5b9e\u8df5",level:2},{value:"12.12.1 \u5ba2\u6237\u7aef\u91cd\u7528",id:"12121-\u5ba2\u6237\u7aef\u91cd\u7528",level:3},{value:"12.12.2 \u8d85\u65f6\u8bbe\u7f6e",id:"12122-\u8d85\u65f6\u8bbe\u7f6e",level:3},{value:"12.12.3 \u9519\u8bef\u91cd\u8bd5\u673a\u5236",id:"12123-\u9519\u8bef\u91cd\u8bd5\u673a\u5236",level:3},{value:"12.12.4 \u76d1\u63a7\u548c\u6307\u6807",id:"12124-\u76d1\u63a7\u548c\u6307\u6807",level:3},{value:"12.13 \u5b8c\u6574\u793a\u4f8b",id:"1213-\u5b8c\u6574\u793a\u4f8b",level:2},{value:"12.13.1 \u57fa\u7840\u4f7f\u7528\u793a\u4f8b",id:"12131-\u57fa\u7840\u4f7f\u7528\u793a\u4f8b",level:3},{value:"12.13.2 \u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5\u793a\u4f8b",id:"12132-\u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5\u793a\u4f8b",level:3},{value:"12.14 \u603b\u7ed3",id:"1214-\u603b\u7ed3",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"12-nyxclient---grpc\u5ba2\u6237\u7aef",children:"12. NyxClient - gRPC\u5ba2\u6237\u7aef"})}),"\n",(0,i.jsx)(e.h2,{id:"121-\u6982\u8ff0",children:"12.1 \u6982\u8ff0"}),"\n",(0,i.jsx)(e.p,{children:"NyxClient \u662f\u4e13\u95e8\u4e3a Nyx \u6846\u67b6\u8bbe\u8ba1\u7684 gRPC \u5ba2\u6237\u7aef\u5e93\uff0c\u5b83\u63d0\u4f9b\u4e86\u5b8c\u6574\u7684 RPC \u5ba2\u6237\u7aef\u529f\u80fd\uff0c\u5305\u62ec\u8fde\u63a5\u6c60\u7ba1\u7406\u3001\u672c\u5730\u7f13\u5b58\u3001\u8ba4\u8bc1\u673a\u5236\u3001\u6d41\u5f0f\u8bf7\u6c42\u652f\u6301\u7b49\u3002NyxClient \u901a\u8fc7\u6807\u51c6\u5316\u7684\u63a5\u53e3\u7b80\u5316\u4e86\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u7684\u4ea4\u4e92\uff0c\u540c\u65f6\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u914d\u7f6e\u9009\u9879\u6765\u6ee1\u8db3\u4e0d\u540c\u7684\u4f7f\u7528\u573a\u666f\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"122-\u6838\u5fc3\u67b6\u6784",children:"12.2 \u6838\u5fc3\u67b6\u6784"}),"\n",(0,i.jsx)(e.p,{children:"NyxClient \u91c7\u7528\u5206\u5c42\u67b6\u6784\u8bbe\u8ba1\uff0c\u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u6838\u5fc3\u7ec4\u4ef6\uff1a"}),"\n",(0,i.jsx)(e.h3,{id:"1221-\u5ba2\u6237\u7aef\u6838\u5fc3-nyxclient",children:"12.2.1 \u5ba2\u6237\u7aef\u6838\u5fc3 (NyxClient)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:"type NyxClient struct {\n    Address string    // \u670d\u52a1\u7aef\u5730\u5740\n    appid   string    // \u5e94\u7528ID\n    secret  string    // \u5e94\u7528\u5bc6\u94a5\n    rpc     *rpc.RpcPool  // \u8fde\u63a5\u6c60\n    logger  *log.Logger   // \u65e5\u5fd7\u8bb0\u5f55\u5668\n    authFn  func(appid, secret string) map[string]string  // \u8ba4\u8bc1\u51fd\u6570\n    cache   cache.Cache   // \u672c\u5730\u7f13\u5b58\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"1222-\u8fde\u63a5\u6c60\u7ba1\u7406-rpcpool",children:"12.2.2 \u8fde\u63a5\u6c60\u7ba1\u7406 (RpcPool)"}),"\n",(0,i.jsx)(e.p,{children:"\u8fde\u63a5\u6c60\u8d1f\u8d23\u7ba1\u7406\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u7684\u8fde\u63a5\uff0c\u5305\u542b\u4ee5\u4e0b\u5173\u952e\u914d\u7f6e\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"MaxIdleConns"}),": \u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"MaxOpenConns"}),": \u6700\u5927\u6253\u5f00\u8fde\u63a5\u6570"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8fde\u63a5\u8d85\u65f6"}),": \u9ed8\u8ba4 3 \u79d2"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"1223-\u54cd\u5e94\u5904\u7406-response--responseiter",children:"12.2.3 \u54cd\u5e94\u5904\u7406 (Response & ResponseIter)"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Response"}),": \u5904\u7406\u5355\u6b21\u8bf7\u6c42\u54cd\u5e94"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"ResponseIter"}),": \u5904\u7406\u6d41\u5f0f\u54cd\u5e94\u8fed\u4ee3"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"123-\u5ba2\u6237\u7aef\u521d\u59cb\u5316",children:"12.3 \u5ba2\u6237\u7aef\u521d\u59cb\u5316"}),"\n",(0,i.jsx)(e.h3,{id:"1231-\u57fa\u672c\u521d\u59cb\u5316",children:"12.3.1 \u57fa\u672c\u521d\u59cb\u5316"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\u521b\u5efa\u5ba2\u6237\u7aef\nclient, err := NewNyxClient("localhost:8080", "your_appid", "your_secret")\nif err != nil {\n    log.Fatal(err)\n}\ndefer client.Close()\n'})}),"\n",(0,i.jsx)(e.h3,{id:"1232-\u81ea\u5b9a\u4e49\u914d\u7f6e",children:"12.3.2 \u81ea\u5b9a\u4e49\u914d\u7f6e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u521b\u5efa\u81ea\u5b9a\u4e49\u914d\u7f6e\u7684\u5ba2\u6237\u7aef\nclient, err := NewNyxClient(\n    "localhost:8080",\n    "your_appid", \n    "your_secret",\n    UseCache(1000),                    // \u542f\u7528\u7f13\u5b58\uff0c\u8bbe\u7f6e\u7f13\u5b58\u5927\u5c0f\u4e3a1000\n    WithMaxIdleConns(10),             // \u8bbe\u7f6e\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\u4e3a10\n    WithMaxOpenConns(50),             // \u8bbe\u7f6e\u6700\u5927\u6253\u5f00\u8fde\u63a5\u6570\u4e3a50\n    WithDialTimeout(5*time.Second),   // \u8bbe\u7f6e\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u4e3a5\u79d2\n)\n'})}),"\n",(0,i.jsx)(e.h2,{id:"124-\u8fde\u63a5\u6c60\u914d\u7f6e",children:"12.4 \u8fde\u63a5\u6c60\u914d\u7f6e"}),"\n",(0,i.jsx)(e.h3,{id:"1241-\u7a7a\u95f2\u8fde\u63a5\u7ba1\u7406",children:"12.4.1 \u7a7a\u95f2\u8fde\u63a5\u7ba1\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u8bbe\u7f6e\u8fde\u63a5\u6c60\u53c2\u6570\nclient, err := NewNyxClient(\n    "localhost:8080",\n    "your_appid", \n    "your_secret",\n    WithMaxIdleConns(20),   // \u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\uff1a20\n    WithMaxOpenConns(100),  // \u6700\u5927\u6253\u5f00\u8fde\u63a5\u6570\uff1a100\n)\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8fde\u63a5\u6c60\u5de5\u4f5c\u539f\u7406"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5f53\u8fde\u63a5\u6c60\u6ee1\u65f6\uff0c\u65b0\u7684\u8bf7\u6c42\u4f1a\u7b49\u5f85\u6700\u591a 3 \u79d2"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679c\u8fde\u63a5\u5931\u8d25\u6b21\u6570\u8fc7\u591a\uff0c\u8be5\u8fde\u63a5\u4f1a\u88ab\u6807\u8bb0\u4e3a\u5931\u8d25\u72b6\u6001\u5e76\u5173\u95ed"}),"\n",(0,i.jsx)(e.li,{children:"\u7a7a\u95f2\u8fde\u63a5\u6570\u8d85\u8fc7\u6700\u5927\u7a7a\u95f2\u6570\u65f6\uff0c\u591a\u4f59\u7684\u8fde\u63a5\u4f1a\u88ab\u5173\u95ed"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"1242-\u8fde\u63a5\u8d85\u65f6\u914d\u7f6e",children:"12.4.2 \u8fde\u63a5\u8d85\u65f6\u914d\u7f6e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u81ea\u5b9a\u4e49\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\nclient, err := NewNyxClient(\n    "localhost:8080",\n    "your_appid", \n    "your_secret",\n    WithDialTimeout(10*time.Second),  // \u8fde\u63a5\u8d85\u65f610\u79d2\n)\n'})}),"\n",(0,i.jsx)(e.h2,{id:"125-\u7f13\u5b58\u673a\u5236",children:"12.5 \u7f13\u5b58\u673a\u5236"}),"\n",(0,i.jsx)(e.h3,{id:"1251-\u542f\u7528\u7f13\u5b58",children:"12.5.1 \u542f\u7528\u7f13\u5b58"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u542f\u7528\u7f13\u5b58\uff0c\u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\nclient, err := NewNyxClient(\n    "localhost:8080",\n    "your_appid", \n    "your_secret",\n    UseCache(),  // \u4f7f\u7528\u9ed8\u8ba4\u7f13\u5b58\u5927\u5c0f(1000)\n)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"1252-\u81ea\u5b9a\u4e49\u7f13\u5b58\u5927\u5c0f",children:"12.5.2 \u81ea\u5b9a\u4e49\u7f13\u5b58\u5927\u5c0f"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7f13\u5b58\u5927\u5c0f\nclient, err := NewNyxClient(\n    "localhost:8080",\n    "your_appid", \n    "your_secret",\n    UseCache(5000),  // \u8bbe\u7f6e\u7f13\u5b58\u5927\u5c0f\u4e3a5000\n)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"1253-\u8bf7\u6c42\u7ea7\u7f13\u5b58\u914d\u7f6e",children:"12.5.3 \u8bf7\u6c42\u7ea7\u7f13\u5b58\u914d\u7f6e"}),"\n",(0,i.jsx)(e.h4,{id:"12531-\u56fa\u5b9attl\u7f13\u5b58",children:"12.5.3.1 \u56fa\u5b9aTTL\u7f13\u5b58"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u8bf7\u6c42\u4f7f\u752860\u79d2TTL\u7684\u7f13\u5b58\nresponse, err := client.Request(\n    "user.getInfo",\n    params,\n    WithCache(60),  // \u7f13\u5b5860\u79d2\n)\n'})}),"\n",(0,i.jsx)(e.h4,{id:"12532-\u81ea\u52a8\u5237\u65b0\u7f13\u5b58",children:"12.5.3.2 \u81ea\u52a8\u5237\u65b0\u7f13\u5b58"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u8bf7\u6c42\u4f7f\u7528\u81ea\u52a8\u5237\u65b0\u7f13\u5b58\uff0c\u5237\u65b0\u95f4\u969430\u79d2\nresponse, err := client.Request(\n    "user.getInfo", \n    params,\n    WithRefreshCache(30),  // \u6bcf30\u79d2\u81ea\u52a8\u5237\u65b0\u4e00\u6b21\n)\n'})}),"\n",(0,i.jsx)(e.h4,{id:"12533-\u7f13\u5b58\u56de\u8c03\u51fd\u6570",children:"12.5.3.3 \u7f13\u5b58\u56de\u8c03\u51fd\u6570"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u5b9a\u4e49\u7f13\u5b58\u66f4\u65b0\u56de\u8c03\u51fd\u6570\ncacheCallback := func(data map[string]any) error {\n    fmt.Printf("\u7f13\u5b58\u5df2\u66f4\u65b0: %+v\\n", data)\n    return nil\n}\n\n// \u4f7f\u7528\u56de\u8c03\u51fd\u6570\u7684\u7f13\u5b58\u8bf7\u6c42\nresponse, err := client.Request(\n    "user.getInfo",\n    params, \n    WithCache(60, cacheCallback),\n)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"1254-\u7f13\u5b58\u5de5\u4f5c\u539f\u7406",children:"12.5.4 \u7f13\u5b58\u5de5\u4f5c\u539f\u7406"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7f13\u5b58\u952e\u751f\u6210"}),": \u57fa\u4e8e\u65b9\u6cd5\u540d\u548c\u53c2\u6570\u751f\u6210\u552f\u4e00\u952e"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7f13\u5b58\u5b58\u50a8"}),": \u4f7f\u7528 Gob \u7f16\u7801\u5b58\u50a8\u54cd\u5e94\u6570\u636e\u3001\u5934\u90e8\u4fe1\u606f\u3001\u5c3e\u90e8\u4fe1\u606f\u548c\u7f13\u5b58\u65f6\u95f4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7f13\u5b58\u547d\u4e2d"}),": \u4f18\u5148\u8fd4\u56de\u7f13\u5b58\u6570\u636e\uff0c\u51cf\u5c11\u670d\u52a1\u7aef\u8bf7\u6c42"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u81ea\u52a8\u5237\u65b0"}),": \u652f\u6301\u5b9a\u65f6\u5237\u65b0\u7f13\u5b58\uff0c\u4fdd\u6301\u6570\u636e\u65b0\u9c9c\u5ea6"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"1255-\u68c0\u67e5\u7f13\u5b58\u72b6\u6001",children:"12.5.5 \u68c0\u67e5\u7f13\u5b58\u72b6\u6001"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'response, err := client.Request("user.getInfo", params)\n\n// \u68c0\u67e5\u662f\u5426\u547d\u4e2d\u7f13\u5b58\nif response.HitCache {\n    cacheTime, _ := response.GetCacheTime()\n    fmt.Printf("\u547d\u4e2d\u7f13\u5b58\uff0c\u7f13\u5b58\u65f6\u95f4: %v\\n", cacheTime)\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"126-\u8bf7\u6c42\u5904\u7406",children:"12.6 \u8bf7\u6c42\u5904\u7406"}),"\n",(0,i.jsx)(e.h3,{id:"1261-\u540c\u6b65\u8bf7\u6c42",children:"12.6.1 \u540c\u6b65\u8bf7\u6c42"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u57fa\u672c\u540c\u6b65\u8bf7\u6c42\nresponse, err := client.Request("user.getInfo", map[string]any{\n    "user_id": 123,\n})\nif err != nil {\n    log.Printf("\u8bf7\u6c42\u5931\u8d25: %v", err)\n    return\n}\n\n// \u68c0\u67e5\u54cd\u5e94\u72b6\u6001\nif response.GetCode() != 0 {\n    log.Printf("\u4e1a\u52a1\u9519\u8bef: %s", response.GetMsg())\n    return\n}\n\n// \u83b7\u53d6\u54cd\u5e94\u6570\u636e\ndata := response.GetData()\nuserName := data["name"].(string)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"1262-\u6d41\u5f0f\u8bf7\u6c42",children:"12.6.2 \u6d41\u5f0f\u8bf7\u6c42"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u6d41\u5f0f\u8bf7\u6c42\u5904\u7406\niter, err := client.RequestStream("user.streamData", params)\nif err != nil {\n    log.Printf("\u6d41\u5f0f\u8bf7\u6c42\u5931\u8d25: %v", err)\n    return\n}\n\n// \u65b9\u6cd51: \u9010\u884c\u5904\u7406\u6d41\u6570\u636e\nerr = iter.Foreach(func(res *rpc.Response) error {\n    data := res.GetData()\n    fmt.Printf("\u63a5\u6536\u5230\u6570\u636e: %+v\\n", data)\n    return nil\n})\n\n// \u65b9\u6cd52: \u6536\u96c6\u6240\u6709\u6d41\u6570\u636e\nresults, err := iter.Collect()\nfor _, res := range results {\n    data := res.GetData()\n    fmt.Printf("\u6536\u96c6\u5230\u7684\u6570\u636e: %+v\\n", data)\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"1263-\u8bf7\u6c42\u53c2\u6570\u5904\u7406",children:"12.6.3 \u8bf7\u6c42\u53c2\u6570\u5904\u7406"}),"\n",(0,i.jsx)(e.p,{children:"NyxClient \u652f\u6301\u591a\u79cd\u53c2\u6570\u7c7b\u578b\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u7ed3\u6784\u4f53\u53c2\u6570\ntype UserParams struct {\n    UserID   int64  `json:"user_id"`\n    UserName string `json:"user_name"`\n}\n\n// \u7ed3\u6784\u4f53\u53c2\u6570\nparams := UserParams{\n    UserID:   123,\n    UserName: "\u5f20\u4e09",\n}\nresponse, err := client.Request("user.update", params)\n\n// Map\u53c2\u6570\nparams := map[string]any{\n    "user_id":   123,\n    "user_name": "\u5f20\u4e09",\n}\nresponse, err := client.Request("user.update", params)\n'})}),"\n",(0,i.jsx)(e.h2,{id:"127-\u8bf7\u6c42\u9009\u9879\u914d\u7f6e",children:"12.7 \u8bf7\u6c42\u9009\u9879\u914d\u7f6e"}),"\n",(0,i.jsx)(e.h3,{id:"1271-\u8d85\u65f6\u914d\u7f6e",children:"12.7.1 \u8d85\u65f6\u914d\u7f6e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u8bbe\u7f6e\u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\nresponse, err := client.Request(\n    "user.getInfo",\n    params,\n    WithTimeout(5*time.Second),  // 5\u79d2\u8d85\u65f6\n)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"1272-\u4e0a\u4e0b\u6587\u4f20\u9012",children:"12.7.2 \u4e0a\u4e0b\u6587\u4f20\u9012"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u4f7f\u7528\u81ea\u5b9a\u4e49\u4e0a\u4e0b\u6587\nctx := context.Background()\nctx = context.WithValue(ctx, "guid", "your-guid")\n\nresponse, err := client.Request(\n    "user.getInfo",\n    params,\n    WithContext(ctx),\n)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"1273-\u81ea\u5b9a\u4e49\u5934\u90e8\u4fe1\u606f",children:"12.7.3 \u81ea\u5b9a\u4e49\u5934\u90e8\u4fe1\u606f"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u6dfb\u52a0\u81ea\u5b9a\u4e49\u5934\u90e8\nheaders := map[string]string{\n    "X-Client-Version": "1.0.0",\n    "X-Request-ID":     "req-123",\n}\n\nresponse, err := client.Request(\n    "user.getInfo", \n    params,\n    WithHeaders(headers),\n)\n'})}),"\n",(0,i.jsx)(e.h2,{id:"128-\u8ba4\u8bc1\u673a\u5236",children:"12.8 \u8ba4\u8bc1\u673a\u5236"}),"\n",(0,i.jsx)(e.h3,{id:"1281-\u9ed8\u8ba4\u8ba4\u8bc1",children:"12.8.1 \u9ed8\u8ba4\u8ba4\u8bc1"}),"\n",(0,i.jsx)(e.p,{children:"NyxClient \u81ea\u52a8\u5904\u7406\u8ba4\u8bc1\uff0c\u5728\u6bcf\u4e2a\u8bf7\u6c42\u4e2d\u5305\u542b\u4ee5\u4e0b\u5934\u90e8\u4fe1\u606f\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"Authorization"}),": \u8ba4\u8bc1\u4ee4\u724c"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"X-Appid"}),": \u5e94\u7528ID"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"guid"}),": \u5168\u5c40\u552f\u4e00\u6807\u8bc6\u7b26"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"1282-\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u51fd\u6570",children:"12.8.2 \u81ea\u5b9a\u4e49\u8ba4\u8bc1\u51fd\u6570"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u5b9a\u4e49\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u51fd\u6570\ncustomAuthFn := func(appid, secret string) map[string]string {\n    // \u751f\u6210\u81ea\u5b9a\u4e49token\u903b\u8f91\n    token := generateCustomToken(appid, secret)\n    return map[string]string{\n        "Authorization": "Bearer " + token,\n        "X-Custom-Header": "custom-value",\n    }\n}\n\n// \u4f7f\u7528\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u51fd\u6570\u521b\u5efa\u5ba2\u6237\u7aef\nclient, err := NewNyxClient(\n    "localhost:8080",\n    "your_appid",\n    "your_secret",\n    WithAuthFn(customAuthFn),\n)\n'})}),"\n",(0,i.jsx)(e.h2,{id:"129-\u9519\u8bef\u5904\u7406",children:"12.9 \u9519\u8bef\u5904\u7406"}),"\n",(0,i.jsx)(e.h3,{id:"1291-\u7f51\u7edc\u9519\u8bef\u5904\u7406",children:"12.9.1 \u7f51\u7edc\u9519\u8bef\u5904\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'response, err := client.Request("user.getInfo", params)\nif err != nil {\n    // \u7f51\u7edc\u6216\u8fde\u63a5\u9519\u8bef\n    log.Printf("\u7f51\u7edc\u9519\u8bef: %v", err)\n    \n    // \u68c0\u67e5\u662f\u5426\u4e3a\u8fde\u63a5\u6c60\u6ee1\u9519\u8bef\n    if strings.Contains(err.Error(), "pool is full") {\n        // \u5904\u7406\u8fde\u63a5\u6c60\u6ee1\u7684\u60c5\u51b5\n        time.Sleep(time.Second)\n        // \u91cd\u8bd5\u903b\u8f91\n        response, err = client.Request("user.getInfo", params)\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"1292-\u4e1a\u52a1\u9519\u8bef\u5904\u7406",children:"12.9.2 \u4e1a\u52a1\u9519\u8bef\u5904\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'response, err := client.Request("user.getInfo", params)\nif err == nil {\n    // \u7f51\u7edc\u8bf7\u6c42\u6210\u529f\uff0c\u68c0\u67e5\u4e1a\u52a1\u72b6\u6001\n    code := response.GetCode()\n    if code != 0 {\n        // \u4e1a\u52a1\u903b\u8f91\u9519\u8bef\n        msg := response.GetMsg()\n        log.Printf("\u4e1a\u52a1\u9519\u8bef [%d]: %s", code, msg)\n        return\n    }\n    \n    // \u5904\u7406\u6b63\u5e38\u54cd\u5e94\n    data := response.GetData()\n    // ...\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"1293-\u6d41\u5f0f\u8bf7\u6c42\u9519\u8bef\u5904\u7406",children:"12.9.3 \u6d41\u5f0f\u8bf7\u6c42\u9519\u8bef\u5904\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'iter, err := client.RequestStream("user.streamData", params)\nif err != nil {\n    log.Printf("\u6d41\u5f0f\u8bf7\u6c42\u5931\u8d25: %v", err)\n    return\n}\n\nerr = iter.Foreach(func(res *rpc.Response) error {\n    if res.GetCode() != 0 {\n        // \u6d41\u4e2d\u7684\u4e1a\u52a1\u9519\u8bef\n        log.Printf("\u6d41\u5f0f\u4e1a\u52a1\u9519\u8bef: %s", res.GetMsg())\n        return nil  // \u7ee7\u7eed\u5904\u7406\u4e0b\u4e00\u6761\n    }\n    \n    // \u5904\u7406\u6b63\u5e38\u6570\u636e\n    data := res.GetData()\n    // ...\n    return nil\n})\n'})}),"\n",(0,i.jsx)(e.h2,{id:"1210-\u65e5\u5fd7\u8bb0\u5f55",children:"12.10 \u65e5\u5fd7\u8bb0\u5f55"}),"\n",(0,i.jsx)(e.h3,{id:"12101-\u65e5\u5fd7\u7ea7\u522b\u548c\u8f93\u51fa",children:"12.10.1 \u65e5\u5fd7\u7ea7\u522b\u548c\u8f93\u51fa"}),"\n",(0,i.jsx)(e.p,{children:"NyxClient \u652f\u6301\u591a\u7ea7\u522b\u65e5\u5fd7\u8bb0\u5f55\uff1a"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8bf7\u6c42\u65e5\u5fd7"}),": \u8bb0\u5f55\u6240\u6709\u8bf7\u6c42\u7684\u8be6\u7ec6\u4fe1\u606f"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9519\u8bef\u65e5\u5fd7"}),": \u4e13\u95e8\u8bb0\u5f55\u9519\u8bef\u4fe1\u606f"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"12102-\u542f\u7528\u8c03\u8bd5\u6a21\u5f0f",children:"12.10.2 \u542f\u7528\u8c03\u8bd5\u6a21\u5f0f"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'client, err := NewNyxClient(\n    "localhost:8080",\n    "your_appid",\n    "your_secret",\n    WithDebug(true),  // \u542f\u7528\u8c03\u8bd5\u6a21\u5f0f\n)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"12103-\u65e5\u5fd7\u6587\u4ef6",children:"12.10.3 \u65e5\u5fd7\u6587\u4ef6"}),"\n",(0,i.jsx)(e.p,{children:"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u65e5\u5fd7\u6587\u4ef6\u4f1a\u8f93\u51fa\u5230\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"logs/nyxclient-YYYY-MM-DD.log"}),": \u4e00\u822c\u65e5\u5fd7"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"logs/nyxclient-err-YYYY-MM-DD.log"}),": \u9519\u8bef\u65e5\u5fd7"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"12104-\u96c6\u6210-nyx-\u6846\u67b6\u65e5\u5fd7",children:"12.10.4 \u96c6\u6210 Nyx \u6846\u67b6\u65e5\u5fd7"}),"\n",(0,i.jsxs)(e.p,{children:["\u5982\u679c\u5728 Nyx \u6846\u67b6\u9879\u76ee\u4e2d\u4f7f\u7528\uff0cNyxClient \u4f1a\u81ea\u52a8\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"x.Logger"})," \u7684\u914d\u7f6e\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u5728 Nyx \u6846\u67b6\u9879\u76ee\u4e2d\nif x.Logger != nil {\n    nyxclient.cache = x.LocalCache\n    x.Info("nyxclient use x.LocalCache")\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"1211-\u6027\u80fd\u4f18\u5316",children:"12.11 \u6027\u80fd\u4f18\u5316"}),"\n",(0,i.jsx)(e.h3,{id:"12111-\u8fde\u63a5\u6c60\u4f18\u5316",children:"12.11.1 \u8fde\u63a5\u6c60\u4f18\u5316"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u9ad8\u5e76\u53d1\u573a\u666f\u7684\u8fde\u63a5\u6c60\u914d\u7f6e\nclient, err := NewNyxClient(\n    "localhost:8080",\n    "your_appid",\n    "your_secret",\n    WithMaxIdleConns(50),   // \u589e\u52a0\u7a7a\u95f2\u8fde\u63a5\n    WithMaxOpenConns(200),  // \u589e\u52a0\u6700\u5927\u8fde\u63a5\n    WithDialTimeout(1*time.Second),  // \u51cf\u5c11\u8fde\u63a5\u8d85\u65f6\n)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"12112-\u7f13\u5b58\u7b56\u7565",children:"12.11.2 \u7f13\u5b58\u7b56\u7565"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u70ed\u70b9\u6570\u636e\u7f13\u5b58\u7b56\u7565\nresponse, err := client.Request(\n    "config.getSettings",\n    params,\n    WithRefreshCache(300),  // 5\u5206\u949f\u81ea\u52a8\u5237\u65b0\n)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"12113-\u5e76\u53d1\u8bf7\u6c42",children:"12.11.3 \u5e76\u53d1\u8bf7\u6c42"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u5e76\u53d1\u8bf7\u6c42\u793a\u4f8b\nvar wg sync.WaitGroup\nresponses := make(chan *rpc.Response, len(requests))\n\nfor i, req := range requests {\n    wg.Add(1)\n    go func(r Request, idx int) {\n        defer wg.Done()\n        \n        resp, err := client.Request(r.Method, r.Params)\n        if err != nil {\n            log.Printf("\u8bf7\u6c42 %d \u5931\u8d25: %v", idx, err)\n            return\n        }\n        \n        responses <- resp\n    }(req, i)\n}\n\nwg.Wait()\nclose(responses)\n\n// \u5904\u7406\u6240\u6709\u54cd\u5e94\nfor resp := range responses {\n    // \u5904\u7406\u54cd\u5e94\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"1212-\u6700\u4f73\u5b9e\u8df5",children:"12.12 \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsx)(e.h3,{id:"12121-\u5ba2\u6237\u7aef\u91cd\u7528",children:"12.12.1 \u5ba2\u6237\u7aef\u91cd\u7528"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u5728\u5e94\u7528\u542f\u52a8\u65f6\u521b\u5efa\u5ba2\u6237\u7aef\uff0c\u6574\u4e2a\u751f\u547d\u5468\u671f\u91cd\u7528\nvar globalClient *NyxClient\n\nfunc init() {\n    client, err := NewNyxClient("localhost:8080", "appid", "secret")\n    if err != nil {\n        log.Fatal("Failed to create NyxClient:", err)\n    }\n    globalClient = client\n}\n\nfunc getUserInfo(userID int64) (*rpc.Response, error) {\n    return globalClient.Request("user.getInfo", map[string]any{\n        "user_id": userID,\n    })\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"12122-\u8d85\u65f6\u8bbe\u7f6e",children:"12.12.2 \u8d85\u65f6\u8bbe\u7f6e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u6839\u636e\u4e1a\u52a1\u573a\u666f\u8bbe\u7f6e\u5408\u9002\u7684\u8d85\u65f6\u65f6\u95f4\nctx, cancel := context.WithTimeout(context.Background(), 3*time.Second)\ndefer cancel()\n\nresponse, err := client.Request(\n    "user.getInfo",\n    params,\n    WithContext(ctx),\n    WithTimeout(2*time.Second),  // \u8bf7\u6c42\u8d85\u65f62\u79d2\n)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"12123-\u9519\u8bef\u91cd\u8bd5\u673a\u5236",children:"12.12.3 \u9519\u8bef\u91cd\u8bd5\u673a\u5236"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u5e26\u91cd\u8bd5\u7684\u8bf7\u6c42\u51fd\u6570\nfunc requestWithRetry(client *NyxClient, method string, params any, maxRetries int) (*rpc.Response, error) {\n    for i := 0; i < maxRetries; i++ {\n        response, err := client.Request(method, params)\n        if err == nil {\n            return response, nil\n        }\n        \n        // \u7f51\u7edc\u9519\u8bef\u624d\u91cd\u8bd5\n        if isNetworkError(err) {\n            time.Sleep(time.Duration(i+1) * time.Second)\n            continue\n        }\n        \n        // \u4e1a\u52a1\u9519\u8bef\u4e0d\u91cd\u8bd5\n        return nil, err\n    }\n    \n    return nil, fmt.Errorf("max retries exceeded")\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"12124-\u76d1\u63a7\u548c\u6307\u6807",children:"12.12.4 \u76d1\u63a7\u548c\u6307\u6807"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'// \u8bb0\u5f55\u8bf7\u6c42\u6027\u80fd\u6307\u6807\nfunc requestWithMetrics(client *NyxClient, method string, params any) (*rpc.Response, error) {\n    start := time.Now()\n    \n    response, err := client.Request(method, params)\n    \n    duration := time.Since(start)\n    status := "success"\n    if err != nil {\n        status = "error"\n    }\n    \n    // \u8bb0\u5f55\u6027\u80fd\u6307\u6807\n    log.Printf("method=%s duration=%v status=%s", method, duration, status)\n    \n    return response, err\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"1213-\u5b8c\u6574\u793a\u4f8b",children:"12.13 \u5b8c\u6574\u793a\u4f8b"}),"\n",(0,i.jsx)(e.h3,{id:"12131-\u57fa\u7840\u4f7f\u7528\u793a\u4f8b",children:"12.13.1 \u57fa\u7840\u4f7f\u7528\u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n    "fmt"\n    "log"\n    "time"\n    \n    "github.com/nyxless/nyx/x"\n    "github.com/nyxless/nyxc"\n    "github.com/nyxless/nyxc/rpc"\n)\n\nfunc main() {\n    // 1. \u521b\u5efa\u5ba2\u6237\u7aef\n    client, err := grpc.NewNyxClient(\n        "localhost:8080",\n        "demo_app",\n        "demo_secret",\n        grpc.UseCache(1000),                    // \u542f\u7528\u7f13\u5b58\n        grpc.WithMaxIdleConns(10),             // \u8fde\u63a5\u6c60\u914d\u7f6e\n        grpc.WithMaxOpenConns(50),\n        grpc.WithTimeout(5*time.Second),        // \u8bf7\u6c42\u8d85\u65f6\n        grpc.WithDebug(true),                   // \u542f\u7528\u8c03\u8bd5\n    )\n    if err != nil {\n        log.Fatal("\u521b\u5efa\u5ba2\u6237\u7aef\u5931\u8d25:", err)\n    }\n    defer client.Close()\n    \n    // 2. \u540c\u6b65\u8bf7\u6c42\u793a\u4f8b\n    fmt.Println("=== \u540c\u6b65\u8bf7\u6c42\u793a\u4f8b ===")\n    \n    // \u7b80\u5355\u53c2\u6570\u8bf7\u6c42\n    response, err := client.Request("user.getInfo", map[string]any{\n        "user_id": 123,\n    })\n    if err != nil {\n        log.Printf("\u8bf7\u6c42\u5931\u8d25: %v", err)\n    } else {\n        fmt.Printf("\u54cd\u5e94\u4ee3\u7801: %d\\n", response.GetCode())\n        fmt.Printf("\u54cd\u5e94\u6d88\u606f: %s\\n", response.GetMsg())\n        if response.HitCache {\n            cacheTime, _ := response.GetCacheTime()\n            fmt.Printf("\u547d\u4e2d\u7f13\u5b58\uff0c\u65f6\u95f4: %v\\n", cacheTime)\n        }\n        \n        data := response.GetData()\n        fmt.Printf("\u54cd\u5e94\u6570\u636e: %+v\\n", data)\n    }\n    \n    // 3. \u5e26\u7f13\u5b58\u7684\u8bf7\u6c42\u793a\u4f8b\n    fmt.Println("\\n=== \u7f13\u5b58\u8bf7\u6c42\u793a\u4f8b ===")\n    \n    response, err = client.Request(\n        "config.getSettings",\n        map[string]any{"config_key": "app_settings"},\n        rpc.WithCache(60),  // 60\u79d2\u7f13\u5b58\n    )\n    if err != nil {\n        log.Printf("\u914d\u7f6e\u83b7\u53d6\u5931\u8d25: %v", err)\n    } else {\n        fmt.Printf("\u914d\u7f6e\u6570\u636e: %+v\\n", response.GetData())\n    }\n    \n    // 4. \u6d41\u5f0f\u8bf7\u6c42\u793a\u4f8b\n    fmt.Println("\\n=== \u6d41\u5f0f\u8bf7\u6c42\u793a\u4f8b ===")\n    \n    streamIter, err := client.RequestStream(\n        "data.streamProcessor",\n        map[string]any{\n            "batch_size": 100,\n            "filter":     "active_users",\n        },\n    )\n    if err != nil {\n        log.Printf("\u6d41\u5f0f\u8bf7\u6c42\u5931\u8d25: %v", err)\n    } else {\n        // \u5904\u7406\u6d41\u6570\u636e\n        count := 0\n        err = streamIter.Foreach(func(res *rpc.Response) error {\n            if res.GetCode() == 0 {\n                data := res.GetData()\n                fmt.Printf("\u6d41\u6570\u636e %d: %+v\\n", count+1, data)\n                count++\n            }\n            return nil\n        })\n        \n        if err != nil {\n            log.Printf("\u6d41\u5904\u7406\u9519\u8bef: %v", err)\n        } else {\n            fmt.Printf("\u5171\u5904\u7406 %d \u6761\u6d41\u6570\u636e\\n", count)\n        }\n    }\n    \n    // 5. \u9ad8\u7ea7\u914d\u7f6e\u793a\u4f8b\n    fmt.Println("\\n=== \u9ad8\u7ea7\u914d\u7f6e\u793a\u4f8b ===")\n    \n    // \u81ea\u5b9a\u4e49\u4e0a\u4e0b\u6587\u7684\u8bf7\u6c42\n    ctx := context.Background()\n    ctx = context.WithValue(ctx, "guid", x.GetUUID())\n    \n    response, err = client.Request(\n        "user.updateProfile",\n        map[string]any{\n            "user_id":   123,\n            "user_name": "\u65b0\u7528\u6237\u540d",\n            "email":     "newemail@example.com",\n        },\n        rpc.WithContext(ctx),\n        rpc.WithTimeout(10*time.Second),\n        rpc.WithHeaders(map[string]string{\n            "X-Client-Version": "1.0.0",\n            "X-Request-ID":     "req-456",\n        }),\n    )\n    \n    if err != nil {\n        log.Printf("\u66f4\u65b0\u8bf7\u6c42\u5931\u8d25: %v", err)\n    } else {\n        fmt.Printf("\u66f4\u65b0\u7ed3\u679c: %+v\\n", response.GetData())\n    }\n    \n    fmt.Println("=== NyxClient \u793a\u4f8b\u5b8c\u6210 ===")\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"12132-\u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5\u793a\u4f8b",children:"12.13.2 \u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5\u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package retry\n\nimport (\n    "context"\n    "fmt"\n    "log"\n    "net"\n    "strings"\n    "time"\n    \n    "github.com/nyxless/nyxc/rpc"\n    "google.golang.org/grpc/status"\n    "google.golang.org/grpc/codes"\n)\n\ntype RetryConfig struct {\n    MaxRetries int\n    BaseDelay time.Duration\n    MaxDelay  time.Duration\n}\n\nfunc RequestWithRetry(client *rpc.NyxClient, method string, params any, config RetryConfig) (*rpc.Response, error) {\n    var lastErr error\n    \n    for attempt := 0; attempt <= config.MaxRetries; attempt++ {\n        ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)\n        defer cancel()\n        \n        response, err := client.Request(\n            method,\n            params,\n            rpc.WithContext(ctx),\n            rpc.WithTimeout(25*time.Second),\n        )\n        \n        if err == nil {\n            // \u8bf7\u6c42\u6210\u529f\n            if attempt > 0 {\n                fmt.Printf("\u8bf7\u6c42\u6210\u529f\uff0c\u5c1d\u8bd5\u6b21\u6570: %d\\n", attempt+1)\n            }\n            return response, nil\n        }\n        \n        lastErr = err\n        \n        // \u5224\u65ad\u662f\u5426\u4e3a\u53ef\u91cd\u8bd5\u7684\u9519\u8bef\n        if !isRetryableError(err) {\n            fmt.Printf("\u4e0d\u53ef\u91cd\u8bd5\u7684\u9519\u8bef: %v\\n", err)\n            return nil, err\n        }\n        \n        // \u6700\u540e\u4e00\u6b21\u5c1d\u8bd5\u5931\u8d25\n        if attempt == config.MaxRetries {\n            fmt.Printf("\u8fbe\u5230\u6700\u5927\u91cd\u8bd5\u6b21\u6570 (%d)\uff0c\u6700\u540e\u9519\u8bef: %v\\n", config.MaxRetries, lastErr)\n            return nil, lastErr\n        }\n        \n        // \u8ba1\u7b97\u5ef6\u8fdf\u65f6\u95f4 (\u6307\u6570\u9000\u907f)\n        delay := time.Duration(1<<uint(attempt)) * config.BaseDelay\n        if delay > config.MaxDelay {\n            delay = config.MaxDelay\n        }\n        \n        fmt.Printf("\u8bf7\u6c42\u5931\u8d25 (\u5c1d\u8bd5 %d/%d): %v\uff0c%v \u540e\u91cd\u8bd5\\n", attempt+1, config.MaxRetries+1, err, delay)\n        time.Sleep(delay)\n    }\n    \n    return nil, lastErr\n}\n\nfunc isRetryableError(err error) bool {\n    // \u7f51\u7edc\u76f8\u5173\u9519\u8bef\u53ef\u91cd\u8bd5\n    if netErr, ok := err.(net.Error); ok && netErr.Timeout() {\n        return true\n    }\n    \n    // gRPC \u72b6\u6001\u9519\u8bef\n    if grpcStatus, ok := status.FromError(err); ok {\n        switch grpcStatus.Code() {\n        case codes.Unavailable, codes.DeadlineExceeded, codes.Internal:\n            return true\n        }\n    }\n    \n    // \u8fde\u63a5\u6c60\u6ee1\u9519\u8bef\n    if strings.Contains(err.Error(), "pool is full") {\n        return true\n    }\n    \n    return false\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"1214-\u603b\u7ed3",children:"12.14 \u603b\u7ed3"}),"\n",(0,i.jsx)(e.p,{children:"NyxClient \u662f\u4e00\u4e2a\u529f\u80fd\u5b8c\u6574\u3001\u9ad8\u6027\u80fd\u7684 gRPC \u5ba2\u6237\u7aef\u5e93\uff0c\u5b83\u63d0\u4f9b\u4e86\uff1a"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8fde\u63a5\u6c60\u7ba1\u7406"}),": \u9ad8\u6548\u7684\u8fde\u63a5\u590d\u7528\u548c\u8d44\u6e90\u7ba1\u7406"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u672c\u5730\u7f13\u5b58"}),": \u652f\u6301\u591a\u79cd\u7f13\u5b58\u7b56\u7565\uff0c\u51cf\u5c11\u670d\u52a1\u7aef\u538b\u529b"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8ba4\u8bc1\u673a\u5236"}),": \u81ea\u52a8\u5904\u7406\u8bf7\u6c42\u8ba4\u8bc1\uff0c\u7b80\u5316\u5ba2\u6237\u7aef\u5f00\u53d1"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6d41\u5f0f\u652f\u6301"}),": \u5b8c\u6574\u652f\u6301 gRPC \u6d41\u5f0f\u8bf7\u6c42"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9519\u8bef\u5904\u7406"}),": \u5b8c\u5584\u7684\u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5\u673a\u5236"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6027\u80fd\u4f18\u5316"}),": \u9488\u5bf9\u9ad8\u5e76\u53d1\u573a\u666f\u7684\u4f18\u5316\u914d\u7f6e"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u65e5\u5fd7\u76d1\u63a7"}),": \u8be6\u7ec6\u7684\u65e5\u5fd7\u8bb0\u5f55\u4fbf\u4e8e\u95ee\u9898\u6392\u67e5"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u901a\u8fc7\u5408\u7406\u914d\u7f6e\u548c\u4f7f\u7528 NyxClient\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u6784\u5efa\u7a33\u5b9a\u3001\u9ad8\u6027\u80fd\u7684 RPC \u5ba2\u6237\u7aef\u5e94\u7528\u3002"})]})}function h(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>t,x:()=>c});var s=r(6540);const i={},l=s.createContext(i);function t(n){const e=s.useContext(l);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),s.createElement(l.Provider,{value:e},n.children)}}}]);