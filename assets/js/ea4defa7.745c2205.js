"use strict";(self.webpackChunkmy_docs=self.webpackChunkmy_docs||[]).push([[4768],{7985:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>o,default:()=>x,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"x-utilities","title":"13. X \u5de5\u5177\u96c6","description":"Nyx \u6846\u67b6\u7684 x \u5305\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u5de5\u5177\u51fd\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u8d2f\u7a7f\u4e8e\u6574\u4e2a\u6846\u67b6\u7684\u5404\u4e2a\u5c42\u9762\uff0c\u4ece\u63a7\u5236\u5668\u5230\u670d\u52a1\u5c42\uff0c\u4ece\u8def\u7531\u7ba1\u7406\u5230\u6570\u636e\u5904\u7406\uff0c\u662f\u5f00\u53d1\u8005\u65e5\u5e38\u5f00\u53d1\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u91cd\u8981\u5de5\u5177\u3002\u672c\u7ae0\u5c06\u8be6\u7ec6\u4ecb\u7ecd x \u5305\u4e2d\u6700\u91cd\u8981\u7684\u5de5\u5177\u51fd\u6570\u53ca\u5176\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u7684\u5e94\u7528\u573a\u666f\u3002","source":"@site/docs/13-x-utilities.md","sourceDirName":".","slug":"/x-utilities","permalink":"/docs/x-utilities","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/13-x-utilities.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"12. NyxClient - gRPC\u5ba2\u6237\u7aef","permalink":"/docs/nyxc"}}');var r=s(4848),t=s(8453);const l={},o="13. X \u5de5\u5177\u96c6",d={},c=[{value:"13.1 x \u5305\u6982\u8ff0",id:"131-x-\u5305\u6982\u8ff0",level:2},{value:"13.1.1 x \u5305\u7684\u91cd\u8981\u6027",id:"1311-x-\u5305\u7684\u91cd\u8981\u6027",level:3},{value:"13.1.2 x \u5305\u5bfc\u5165",id:"1312-x-\u5305\u5bfc\u5165",level:3},{value:"13.2 \u7c7b\u578b\u8f6c\u6362\u51fd\u6570",id:"132-\u7c7b\u578b\u8f6c\u6362\u51fd\u6570",level:2},{value:"13.2.1 \u57fa\u7840\u7c7b\u578b\u8f6c\u6362",id:"1321-\u57fa\u7840\u7c7b\u578b\u8f6c\u6362",level:3},{value:"13.2.2 \u5b9e\u9645\u5e94\u7528\u793a\u4f8b",id:"1322-\u5b9e\u9645\u5e94\u7528\u793a\u4f8b",level:3},{value:"13.2.3 \u5b89\u5168\u7684\u7c7b\u578b\u8f6c\u6362",id:"1323-\u5b89\u5168\u7684\u7c7b\u578b\u8f6c\u6362",level:3},{value:"13.4 \u65f6\u95f4\u5de5\u5177\u51fd\u6570",id:"134-\u65f6\u95f4\u5de5\u5177\u51fd\u6570",level:2},{value:"13.4.1 \u65f6\u95f4\u83b7\u53d6\u51fd\u6570",id:"1341-\u65f6\u95f4\u83b7\u53d6\u51fd\u6570",level:3},{value:"13.4.2 \u65f6\u95f4\u683c\u5f0f\u5316",id:"1342-\u65f6\u95f4\u683c\u5f0f\u5316",level:3},{value:"13.5 \u914d\u7f6e\u7ba1\u7406\u51fd\u6570",id:"135-\u914d\u7f6e\u7ba1\u7406\u51fd\u6570",level:2},{value:"13.5.1 \u914d\u7f6e\u8bbf\u95ee\u63a5\u53e3",id:"1351-\u914d\u7f6e\u8bbf\u95ee\u63a5\u53e3",level:3},{value:"13.5.2 \u5b9e\u9645\u5e94\u7528",id:"1352-\u5b9e\u9645\u5e94\u7528",level:3},{value:"13.6 \u62e6\u622a\u5668\u7cfb\u7edf",id:"136-\u62e6\u622a\u5668\u7cfb\u7edf",level:2},{value:"13.6.1 x.Interceptor \u51fd\u6570",id:"1361-xinterceptor-\u51fd\u6570",level:3},{value:"13.6.2 \u62e6\u622a\u5668\u7c7b\u578b",id:"1362-\u62e6\u622a\u5668\u7c7b\u578b",level:3},{value:"13.6.3 \u62e6\u622a\u5668\u5e94\u7528\u573a\u666f",id:"1363-\u62e6\u622a\u5668\u5e94\u7528\u573a\u666f",level:3},{value:"\u53c2\u6570\u9a8c\u8bc1\u62e6\u622a\u5668",id:"\u53c2\u6570\u9a8c\u8bc1\u62e6\u622a\u5668",level:4},{value:"\u4e1a\u52a1\u903b\u8f91\u62e6\u622a\u5668",id:"\u4e1a\u52a1\u903b\u8f91\u62e6\u622a\u5668",level:4},{value:"\u81ea\u5b9a\u4e49\u62e6\u622a\u5668",id:"\u81ea\u5b9a\u4e49\u62e6\u622a\u5668",level:4},{value:"13.7 \u8def\u7531\u5de5\u5177\u51fd\u6570",id:"137-\u8def\u7531\u5de5\u5177\u51fd\u6570",level:2},{value:"13.7.1 \u63a7\u5236\u5668\u6ce8\u518c",id:"1371-\u63a7\u5236\u5668\u6ce8\u518c",level:3},{value:"13.7.2 \u8def\u7531\u51fd\u6570\u6ce8\u518c",id:"1372-\u8def\u7531\u51fd\u6570\u6ce8\u518c",level:3},{value:"13.7.3 \u5b9e\u9645\u5e94\u7528",id:"1373-\u5b9e\u9645\u5e94\u7528",level:3},{value:"13.8 \u8c03\u8bd5\u548c\u65e5\u5fd7\u51fd\u6570",id:"138-\u8c03\u8bd5\u548c\u65e5\u5fd7\u51fd\u6570",level:2},{value:"13.8.1 \u6253\u5370\u51fd\u6570",id:"1381-\u6253\u5370\u51fd\u6570",level:3},{value:"13.8.2 \u6d4b\u8bd5\u5e94\u7528\u4e2d\u7684\u8c03\u8bd5",id:"1382-\u6d4b\u8bd5\u5e94\u7528\u4e2d\u7684\u8c03\u8bd5",level:3},{value:"13.9 \u6570\u636e\u5904\u7406\u51fd\u6570",id:"139-\u6570\u636e\u5904\u7406\u51fd\u6570",level:2},{value:"13.9.1 JSON \u5904\u7406",id:"1391-json-\u5904\u7406",level:3},{value:"13.9.2 \u54c8\u5e0c\u548c\u52a0\u5bc6",id:"1392-\u54c8\u5e0c\u548c\u52a0\u5bc6",level:3},{value:"13.9.3 IP \u5730\u5740\u5904\u7406",id:"1393-ip-\u5730\u5740\u5904\u7406",level:3},{value:"13.10 HTTP\u5ba2\u6237\u7aef\u5de5\u5177",id:"1310-http\u5ba2\u6237\u7aef\u5de5\u5177",level:2},{value:"13.10.1 HTTP\u5ba2\u6237\u7aef\u521d\u59cb\u5316",id:"13101-http\u5ba2\u6237\u7aef\u521d\u59cb\u5316",level:3},{value:"13.10.2 HTTP\u8bf7\u6c42\u65b9\u6cd5",id:"13102-http\u8bf7\u6c42\u65b9\u6cd5",level:3},{value:"13.10.3 \u54cd\u5e94\u5904\u7406",id:"13103-\u54cd\u5e94\u5904\u7406",level:3},{value:"13.10.4 \u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5",id:"13104-\u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5",level:3},{value:"13.11 \u9ad8\u7ea7\u5de5\u5177\u51fd\u6570",id:"1311-\u9ad8\u7ea7\u5de5\u5177\u51fd\u6570",level:2},{value:"13.11.1 \u81ea\u7531\u6620\u5c04 (FreeMap)",id:"13111-\u81ea\u7531\u6620\u5c04-freemap",level:3},{value:"13.11.2 HTTP \u4e2d\u95f4\u4ef6",id:"13112-http-\u4e2d\u95f4\u4ef6",level:3},{value:"13.11.3 \u8d44\u6e90\u5d4c\u5165",id:"13113-\u8d44\u6e90\u5d4c\u5165",level:3},{value:"13.12 \u9519\u8bef\u5904\u7406\u51fd\u6570",id:"1312-\u9519\u8bef\u5904\u7406\u51fd\u6570",level:2},{value:"13.12.1 \u521b\u5efa\u9519\u8bef",id:"13121-\u521b\u5efa\u9519\u8bef",level:3},{value:"13.12.2 \u9519\u8bef\u7c7b\u578b\u4f7f\u7528",id:"13122-\u9519\u8bef\u7c7b\u578b\u4f7f\u7528",level:3},{value:"13.13 \u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570",id:"1313-\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570",level:2},{value:"13.13.1 \u5b57\u7b26\u4e32\u8f6c\u6362",id:"13131-\u5b57\u7b26\u4e32\u8f6c\u6362",level:3},{value:"13.14 \u5b9e\u9645\u9879\u76ee\u5e94\u7528\u603b\u7ed3",id:"1314-\u5b9e\u9645\u9879\u76ee\u5e94\u7528\u603b\u7ed3",level:2},{value:"13.14.1 \u63a7\u5236\u5668\u5c42\u5e94\u7528",id:"13141-\u63a7\u5236\u5668\u5c42\u5e94\u7528",level:3},{value:"13.14.2 \u670d\u52a1\u5c42\u5e94\u7528",id:"13142-\u670d\u52a1\u5c42\u5e94\u7528",level:3},{value:"13.14.3 \u6a21\u578b\u5c42\u5e94\u7528",id:"13143-\u6a21\u578b\u5c42\u5e94\u7528",level:3},{value:"13.15 \u6700\u4f73\u5b9e\u8df5",id:"1315-\u6700\u4f73\u5b9e\u8df5",level:2},{value:"13.15.1 \u7c7b\u578b\u8f6c\u6362\u6700\u4f73\u5b9e\u8df5",id:"13151-\u7c7b\u578b\u8f6c\u6362\u6700\u4f73\u5b9e\u8df5",level:3},{value:"13.15.2 \u62e6\u622a\u5668\u4f7f\u7528\u6700\u4f73\u5b9e\u8df5",id:"13152-\u62e6\u622a\u5668\u4f7f\u7528\u6700\u4f73\u5b9e\u8df5",level:3},{value:"13.16 \u5c0f\u7ed3",id:"1316-\u5c0f\u7ed3",level:2},{value:"\ud83c\udfaf <strong>\u6838\u5fc3\u529f\u80fd</strong>",id:"-\u6838\u5fc3\u529f\u80fd",level:3},{value:"\ud83d\udee0\ufe0f <strong>\u5de5\u5177\u5206\u7c7b</strong>",id:"\ufe0f-\u5de5\u5177\u5206\u7c7b",level:3},{value:"\ud83d\udcbc <strong>\u5b9e\u9645\u5e94\u7528</strong>",id:"-\u5b9e\u9645\u5e94\u7528",level:3},{value:"\ud83d\ude80 <strong>\u6700\u4f73\u5b9e\u8df5</strong>",id:"-\u6700\u4f73\u5b9e\u8df5",level:3}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"13-x-\u5de5\u5177\u96c6",children:"13. X \u5de5\u5177\u96c6"})}),"\n",(0,r.jsx)(e.p,{children:"Nyx \u6846\u67b6\u7684 x \u5305\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u5de5\u5177\u51fd\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u8d2f\u7a7f\u4e8e\u6574\u4e2a\u6846\u67b6\u7684\u5404\u4e2a\u5c42\u9762\uff0c\u4ece\u63a7\u5236\u5668\u5230\u670d\u52a1\u5c42\uff0c\u4ece\u8def\u7531\u7ba1\u7406\u5230\u6570\u636e\u5904\u7406\uff0c\u662f\u5f00\u53d1\u8005\u65e5\u5e38\u5f00\u53d1\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u91cd\u8981\u5de5\u5177\u3002\u672c\u7ae0\u5c06\u8be6\u7ec6\u4ecb\u7ecd x \u5305\u4e2d\u6700\u91cd\u8981\u7684\u5de5\u5177\u51fd\u6570\u53ca\u5176\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u7684\u5e94\u7528\u573a\u666f\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"131-x-\u5305\u6982\u8ff0",children:"13.1 x \u5305\u6982\u8ff0"}),"\n",(0,r.jsx)(e.h3,{id:"1311-x-\u5305\u7684\u91cd\u8981\u6027",children:"13.1.1 x \u5305\u7684\u91cd\u8981\u6027"}),"\n",(0,r.jsx)(e.p,{children:"x \u5305\u662f Nyx \u6846\u67b6\u7684\u6838\u5fc3\u5de5\u5177\u5e93\uff0c\u63d0\u4f9b\u4e86\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u7c7b\u578b\u8f6c\u6362\u51fd\u6570"}),"\uff1a\u5b89\u5168\u7684\u7c7b\u578b\u8f6c\u6362\u548c\u9ed8\u8ba4\u503c\u5904\u7406"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u914d\u7f6e\u7ba1\u7406"}),"\uff1a\u7edf\u4e00\u7684\u914d\u7f6e\u8bbf\u95ee\u63a5\u53e3"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u8def\u7531\u5de5\u5177"}),"\uff1a\u63a7\u5236\u5668\u548c\u8def\u7531\u7684\u6ce8\u518c\u7ba1\u7406"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u62e6\u622a\u5668\u7cfb\u7edf"}),"\uff1a\u5f3a\u5927\u7684\u53c2\u6570\u9a8c\u8bc1\u548c\u4e1a\u52a1\u903b\u8f91\u62e6\u622a"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u65f6\u95f4\u5de5\u5177"}),"\uff1a\u65f6\u95f4\u5904\u7406\u548c\u683c\u5f0f\u5316"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6570\u636e\u5904\u7406"}),"\uff1aJSON \u7f16\u7801\u89e3\u7801\u3001\u54c8\u5e0c\u8ba1\u7b97\u7b49"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u8c03\u8bd5\u5de5\u5177"}),"\uff1a\u65e5\u5fd7\u8f93\u51fa\u548c\u8c03\u8bd5\u4fe1\u606f"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4e2d\u95f4\u4ef6\u5de5\u5177"}),"\uff1aHTTP/RPC \u4e2d\u95f4\u4ef6\u548c\u5d4c\u5165\u8d44\u6e90\u7ba1\u7406"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"1312-x-\u5305\u5bfc\u5165",children:"13.1.2 x \u5305\u5bfc\u5165"}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528 x \u5305\u9700\u8981\u5148\u5bfc\u5165\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'import "github.com/nyxless/nyx/x"\n'})}),"\n",(0,r.jsx)(e.h2,{id:"132-\u7c7b\u578b\u8f6c\u6362\u51fd\u6570",children:"13.2 \u7c7b\u578b\u8f6c\u6362\u51fd\u6570"}),"\n",(0,r.jsx)(e.h3,{id:"1321-\u57fa\u7840\u7c7b\u578b\u8f6c\u6362",children:"13.2.1 \u57fa\u7840\u7c7b\u578b\u8f6c\u6362"}),"\n",(0,r.jsx)(e.p,{children:"x \u5305\u63d0\u4f9b\u4e86\u5b89\u5168\u7684\u7c7b\u578b\u8f6c\u6362\u51fd\u6570\uff0c\u652f\u6301\u5404\u79cd\u57fa\u672c\u7c7b\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"// \u6574\u6570\u7c7b\u578b\u8f6c\u6362\nx.AsInt(value interface{}) int           // \u8f6c int\nx.AsInt8(value interface{}) int8          // \u8f6c int8\nx.AsInt16(value interface{}) int16       // \u8f6c int16\nx.AsInt32(value interface{}) int32       // \u8f6c int32\nx.AsInt64(value interface{}) int64       // \u8f6c int64\n\n// \u65e0\u7b26\u53f7\u6574\u6570\u7c7b\u578b\u8f6c\u6362\nx.AsUint(value interface{}) uint          // \u8f6c uint\nx.AsUint32(value interface{}) uint32     // \u8f6c uint32\nx.AsUint64(value interface{}) uint64     // \u8f6c uint64\n\n// \u6d6e\u70b9\u6570\u7c7b\u578b\u8f6c\u6362\nx.AsFloat32(value interface{}) float32    // \u8f6c float32\nx.AsFloat64(value interface{}) float64    // \u8f6c float64\n\n// \u5e03\u5c14\u7c7b\u578b\u8f6c\u6362\nx.AsBool(value interface{}) bool          // \u8f6c bool\n\n// \u5b57\u7b26\u4e32\u7c7b\u578b\u8f6c\u6362\nx.AsString(value interface{}) string      // \u8f6c string\n\n// \u65f6\u95f4\u7c7b\u578b\u8f6c\u6362\nx.AsTime(value interface{}) time.Time     // \u8f6c time.Time\n\n// \u5b57\u8282\u7c7b\u578b\u8f6c\u6362\nx.AsBytes(value interface{}) []byte       // \u8f6c []byte\n"})}),"\n",(0,r.jsx)(e.h3,{id:"1322-\u5b9e\u9645\u5e94\u7528\u793a\u4f8b",children:"13.2.2 \u5b9e\u9645\u5e94\u7528\u793a\u4f8b"}),"\n",(0,r.jsx)(e.p,{children:"\u4ece\u793a\u4f8b\u5e94\u7528\u4e2d\u53ef\u4ee5\u770b\u5230\u7c7b\u578b\u8f6c\u6362\u7684\u5b9e\u9645\u4f7f\u7528\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u5728\u63a7\u5236\u5668\u4e2d\u4f7f\u7528\nfunc (this *LoginController) LoginAction() {\n    username := this.GetString("username")\n    password := this.GetString("password")\n    \n    // \u4e1a\u52a1\u903b\u8f91\u4e2d\u4f7f\u7528\u7c7b\u578b\u8f6c\u6362\n    daoUser := dao.NewAdvUserDao()\n    userinfo, err := daoUser.GetAdvUserByEmail(username)\n    \n    x.Interceptor(err == nil, common.ERR_PASSWORD)\n}\n\n// \u5728 BaseController \u4e2d\u4f7f\u7528\nfunc (this *BaseController) Init() {\n    this.Auth = svc.NewAuth(this.W, this.R)\n    \n    x.Interceptor(this.Auth.CheckLogin() || this.ControllerName == "login", common.ERR_TOKEN)\n    \n    user_info := this.Auth.GetUserInfo()\n    \n    // \u4f7f\u7528\u7c7b\u578b\u8f6c\u6362\u51fd\u6570\n    this.UserId = x.AsInt(user_info["user_id"])\n    this.UserName = x.AsString(user_info["user_name"])\n    this.AccountId = x.AsInt(user_info["account_id"])\n    this.AccountName = x.AsString(user_info["account_name"])\n    this.SessionId = x.AsString(user_info["session_id"])\n}\n\n// \u5728\u6a21\u578b\u4e2d\u4f7f\u7528\nfunc (this *UserModel) Fill(m x.MAP) {\n    if uid, ok := m["uid"]; ok {\n        this.Uid = x.AsInt64(uid)\n    }\n    if name, ok := m["name"]; ok {\n        this.Name = x.AsString(name)\n    }\n    if gender, ok := m["gender"]; ok {\n        this.Gender = x.AsString(gender)\n    }\n    if info, ok := m["info"]; ok {\n        this.Info = x.AsString(info)\n    }\n    if ext, ok := m["ext"]; ok {\n        this.Ext = x.AsString(ext)\n    }\n    if status, ok := m["status"]; ok {\n        this.Status = x.AsInt(status)\n    }\n    if create_time, ok := m["create_time"]; ok {\n        this.CreateTime = x.AsTime(create_time)\n    }\n    if update_time, ok := m["update_time"]; ok {\n        this.UpdateTime = x.AsTime(update_time)\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"1323-\u5b89\u5168\u7684\u7c7b\u578b\u8f6c\u6362",children:"13.2.3 \u5b89\u5168\u7684\u7c7b\u578b\u8f6c\u6362"}),"\n",(0,r.jsx)(e.p,{children:"x \u5305\u7684\u7c7b\u578b\u8f6c\u6362\u51fd\u6570\u5177\u6709\u5b89\u5168\u7279\u6027\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u9ed8\u8ba4\u503c\u5904\u7406"}),"\uff1a\u5f53\u8f6c\u6362\u5931\u8d25\u65f6\u8fd4\u56de\u96f6\u503c\u800c\u4e0d\u662f panic"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u7c7b\u578b\u68c0\u67e5"}),"\uff1a\u5728\u8f6c\u6362\u524d\u8fdb\u884c\u7c7b\u578b\u9a8c\u8bc1"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u9519\u8bef\u5bb9\u5fcd"}),"\uff1a\u5373\u4f7f\u6570\u636e\u683c\u5f0f\u4e0d\u6b63\u786e\u4e5f\u4e0d\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u5d29\u6e83"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"134-\u65f6\u95f4\u5de5\u5177\u51fd\u6570",children:"13.4 \u65f6\u95f4\u5de5\u5177\u51fd\u6570"}),"\n",(0,r.jsx)(e.h3,{id:"1341-\u65f6\u95f4\u83b7\u53d6\u51fd\u6570",children:"13.4.1 \u65f6\u95f4\u83b7\u53d6\u51fd\u6570"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u6233\uff08\u79d2\uff09\nx.Now() int\n\n// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u5bf9\u8c61\nx.NowTime() time.Time\n"})}),"\n",(0,r.jsx)(e.h3,{id:"1342-\u65f6\u95f4\u683c\u5f0f\u5316",children:"13.4.2 \u65f6\u95f4\u683c\u5f0f\u5316"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u6570\u636e\u5e93\u65f6\u95f4\u683c\u5f0f\nx.DateTime(t time.Time) string\n\n// \u5b9e\u9645\u5e94\u7528\u793a\u4f8b\nfunc (this *Session) UpdateSessionIds() error {\n    updateFn := func(data any) error {\n        sessionIds := map[string]int{}\n        if res, ok := data.([]map[string]any); ok {\n            for _, v := range res {\n                sess := model.NewSessionModel(v)\n                sessionIds[sess.SessionId] = int(sess.UpdateAt.Unix())\n            }\n            SessionIds.Update(sessionIds)\n        }\n        this.removeExpiredSessions()\n        return nil\n    }\n\n    _, err := dao.NewSessionDao().\n        WithRefreshCache(60, updateFn).\n        GetRecords("create_at > ? and update_at > ?", \n            x.DateTime(time.Now().Add(-24*time.Hour)), \n            x.DateTime(time.Now().Add(-15*time.Minute))\n        )\n\n    return err\n}\n\n// \u5728\u7528\u6237\u7ba1\u7406\u4e2d\u7684\u5e94\u7528\nfunc (this *UserController) AddUserAction() {\n    user_info := x.MAP{\n        "name":        name,\n        "gender":      gender,\n        "info":        info,\n        "ext":         ext,\n        "status":      status,\n        "create_time": x.NowTime(),\n        "update_time": x.NowTime(),\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"135-\u914d\u7f6e\u7ba1\u7406\u51fd\u6570",children:"13.5 \u914d\u7f6e\u7ba1\u7406\u51fd\u6570"}),"\n",(0,r.jsx)(e.h3,{id:"1351-\u914d\u7f6e\u8bbf\u95ee\u63a5\u53e3",children:"13.5.1 \u914d\u7f6e\u8bbf\u95ee\u63a5\u53e3"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"// \u83b7\u53d6\u5b57\u7b26\u4e32\u914d\u7f6e\nx.Conf.GetString(key string) string\n\n// \u83b7\u53d6\u6574\u6570\u914d\u7f6e\nx.Conf.GetInt(key string) int\n\n// \u83b7\u53d6\u5e03\u5c14\u914d\u7f6e\nx.Conf.GetBool(key string) bool\n\n// \u83b7\u53d6\u5b57\u7b26\u4e32\u6620\u5c04\nx.Conf.GetStringMap(key string) map[string]string\n"})}),"\n",(0,r.jsx)(e.h3,{id:"1352-\u5b9e\u9645\u5e94\u7528",children:"13.5.2 \u5b9e\u9645\u5e94\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// Cookie \u914d\u7f6e\u83b7\u53d6\nfunc (this *Auth) getCookieConfig() map[string]string {\n    return x.Conf.GetStringMap("cookie_conf")\n}\n\n// \u5728\u8ba4\u8bc1\u4e2d\u4f7f\u7528\u914d\u7f6e\nfunc (this *Auth) CheckLogin() bool {\n    // ... \u8ba4\u8bc1\u903b\u8f91 ...\n    \n    conf := this.getCookieConfig()\n    if x.AsInt(expired) > now && \n       x.MD5(x.AsString(conf["secret"])+userstr+expired) == sign && \n       login_time+x.AsInt(conf["maxlife"]) > now && \n       (check_ip != "Y" || login_ip == x.AsString(x.Ip2long(x.GetHttpIp(this.r)))) {\n        // \u8ba4\u8bc1\u6210\u529f\u903b\u8f91\n    }\n}\n\n// RPC \u5ba2\u6237\u7aef\u914d\u7f6e\nconf := x.Conf.GetStringMap("rpc_client_${service}")\nreturn nyxc.NewNyxClient(conf["host"], conf["appid"], conf["secret"])\n'})}),"\n",(0,r.jsx)(e.h2,{id:"136-\u62e6\u622a\u5668\u7cfb\u7edf",children:"13.6 \u62e6\u622a\u5668\u7cfb\u7edf"}),"\n",(0,r.jsx)(e.h3,{id:"1361-xinterceptor-\u51fd\u6570",children:"13.6.1 x.Interceptor \u51fd\u6570"}),"\n",(0,r.jsx)(e.p,{children:"\u62e6\u622a\u5668\u662f x \u5305\u4e2d\u6700\u91cd\u8981\u7684\u529f\u80fd\u4e4b\u4e00\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"x.Interceptor(condition bool, error_code interface{}, error_message ...interface{})\n"})}),"\n",(0,r.jsx)(e.h3,{id:"1362-\u62e6\u622a\u5668\u7c7b\u578b",children:"13.6.2 \u62e6\u622a\u5668\u7c7b\u578b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"// \u9884\u5b9a\u4e49\u7684\u9519\u8bef\u7c7b\u578b\nx.ERR_PARAMS      // \u53c2\u6570\u9519\u8bef\nx.ERR_OTHER      // \u5176\u4ed6\u9519\u8bef\n"})}),"\n",(0,r.jsx)(e.h3,{id:"1363-\u62e6\u622a\u5668\u5e94\u7528\u573a\u666f",children:"13.6.3 \u62e6\u622a\u5668\u5e94\u7528\u573a\u666f"}),"\n",(0,r.jsx)(e.h4,{id:"\u53c2\u6570\u9a8c\u8bc1\u62e6\u622a\u5668",children:"\u53c2\u6570\u9a8c\u8bc1\u62e6\u622a\u5668"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u5fc5\u586b\u53c2\u6570\u68c0\u67e5\nx.Interceptor(username != "", x.ERR_PARAMS, "username")\nx.Interceptor(password != "", x.ERR_PARAMS, "password")\n\n// \u6570\u503c\u8303\u56f4\u68c0\u67e5\nx.Interceptor(uid > 0, x.ERR_PARAMS, "uid")\nx.Interceptor(page > 0, x.ERR_PARAMS, "page")\nx.Interceptor(num > 0, x.ERR_PARAMS, "num")\n\n// \u5b57\u7b26\u4e32\u957f\u5ea6\u68c0\u67e5\nx.Interceptor(name != "", x.ERR_PARAMS, "name")\nx.Interceptor(gender != "", x.ERR_PARAMS, "gender")\nx.Interceptor(info != "", x.ERR_PARAMS, "info")\nx.Interceptor(ext != "", x.ERR_PARAMS, "ext")\n'})}),"\n",(0,r.jsx)(e.h4,{id:"\u4e1a\u52a1\u903b\u8f91\u62e6\u622a\u5668",children:"\u4e1a\u52a1\u903b\u8f91\u62e6\u622a\u5668"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u9519\u8bef\u68c0\u67e5\nx.Interceptor(err == nil, x.ERR_OTHER, err)\n\n// \u7528\u6237\u8ba4\u8bc1\u68c0\u67e5\nx.Interceptor(err == nil, common.ERR_PASSWORD)\nx.Interceptor(lib.VerifyPassword(password, userinfo.Password), common.ERR_PASSWORD)\nx.Interceptor(model.USER_STATUS_ACTIVE == userinfo.Status, common.ERR_PASSWORD)\n\n// \u767b\u5f55\u72b6\u6001\u68c0\u67e5\nx.Interceptor(this.Auth.CheckLogin() || this.ControllerName == "login", common.ERR_TOKEN)\n'})}),"\n",(0,r.jsx)(e.h4,{id:"\u81ea\u5b9a\u4e49\u62e6\u622a\u5668",children:"\u81ea\u5b9a\u4e49\u62e6\u622a\u5668"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u521b\u5efa\u81ea\u5b9a\u4e49\u9519\u8bef\nvar (\n    ERR_TOKEN    = x.NewErr(106, "CN", "\u8ba4\u8bc1\u5931\u8d25", "EN", "token is invalid")\n    ERR_PASSWORD = x.NewErr(107, "CN", "\u5bc6\u7801\u9519\u8bef", "EN", "password is invalid")\n)\n\n// \u4f7f\u7528\u81ea\u5b9a\u4e49\u9519\u8bef\nx.Interceptor(false, x.NewErr(109, "xxx"))\nx.Interceptor(false, common.ERR_PASSWORD)\n'})}),"\n",(0,r.jsx)(e.h2,{id:"137-\u8def\u7531\u5de5\u5177\u51fd\u6570",children:"13.7 \u8def\u7531\u5de5\u5177\u51fd\u6570"}),"\n",(0,r.jsx)(e.h3,{id:"1371-\u63a7\u5236\u5668\u6ce8\u518c",children:"13.7.1 \u63a7\u5236\u5668\u6ce8\u518c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"// API \u63a7\u5236\u5668\u6ce8\u518c\nx.AddApi(controller controller.BaseController)\n\n// RPC \u63a7\u5236\u5668\u6ce8\u518c\nx.AddRpc(controller controller.BaseController)\n\n// CLI \u63a7\u5236\u5668\u6ce8\u518c\nx.AddCli(controller controller.BaseController)\n"})}),"\n",(0,r.jsx)(e.h3,{id:"1372-\u8def\u7531\u51fd\u6570\u6ce8\u518c",children:"13.7.2 \u8def\u7531\u51fd\u6570\u6ce8\u518c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"// API \u8def\u7531\u6ce8\u518c\nx.AddRouteApiFunc(group, action string, handler http.HandlerFunc)\n\n// RPC \u8def\u7531\u6ce8\u518c\nx.AddRouteRpcFunc(group, action string, handler interface{})\n\n// CLI \u8def\u7531\u6ce8\u518c\nx.AddRouteCliFunc(group, action string, handler http.HandlerFunc)\n"})}),"\n",(0,r.jsx)(e.h3,{id:"1373-\u5b9e\u9645\u5e94\u7528",children:"13.7.3 \u5b9e\u9645\u5e94\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u5728\u8def\u7531\u6ce8\u518c\u4e2d\u4f7f\u7528\nfunc initRoutes() {\n    // \u6ce8\u518c\u63a7\u5236\u5668\n    x.AddApi(&api.UserController{})\n    x.AddApi(&api.LoginController{})\n    x.AddRpc(&rpc.UserController{})\n    x.AddCli(&cli.TestController{})\n\n    // \u6ce8\u518c\u8def\u7531\u51fd\u6570\n    x.AddRouteApiFunc("user", "getuserinfo", route_api_user_getuserinfo)\n    x.AddRouteApiFunc("user", "getuserlist", route_api_user_getuserlist)\n    x.AddRouteApiFunc("user", "adduser", route_api_user_adduser)\n    x.AddRouteApiFunc("user", "setuser", route_api_user_setuser)\n    x.AddRouteApiFunc("user", "deluser", route_api_user_deluser)\n\n    x.AddRouteApiFunc("login", "login", route_api_login_login)\n    x.AddRouteApiFunc("login", "logout", route_api_login_logout)\n\n    x.AddRouteRpcFunc("user", "getuserinfo", route_rpc_user_getuserinfo)\n    x.AddRouteRpcFunc("user", "getuserlist", route_rpc_user_getuserlist)\n    \n    x.AddRouteCliFunc("test", "hello", route_cli_test_hello)\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"138-\u8c03\u8bd5\u548c\u65e5\u5fd7\u51fd\u6570",children:"13.8 \u8c03\u8bd5\u548c\u65e5\u5fd7\u51fd\u6570"}),"\n",(0,r.jsx)(e.h3,{id:"1381-\u6253\u5370\u51fd\u6570",children:"13.8.1 \u6253\u5370\u51fd\u6570"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u57fa\u7840\u6253\u5370\nx.Println(v ...interface{})\n\n// \u5b9e\u9645\u5e94\u7528\u793a\u4f8b\nfunc (this *TestController) HelloAction() {\n    x.Println(this.Form)\n}\n\n// \u5728\u4e2d\u95f4\u4ef6\u4e2d\u4f7f\u7528\nfunc test(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(rw http.ResponseWriter, r *http.Request) {\n        x.Println("test1")\n        \n        x.Println(r.Context().Value("controller"))\n        x.Println(r.Context().Value("action"))\n        x.Println(r.Context().Value("aa"))\n        next.ServeHTTP(rw, r)\n        x.Println(r.Context().Value("controller"))\n        x.Println(r.Context().Value("action"))\n        x.Println(r.Context().Value("aa"))\n        x.Println("test2")\n    })\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"1382-\u6d4b\u8bd5\u5e94\u7528\u4e2d\u7684\u8c03\u8bd5",children:"13.8.2 \u6d4b\u8bd5\u5e94\u7528\u4e2d\u7684\u8c03\u8bd5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'func (this *TestController) Hello1Action() {\n    msg := this.GetParam("msg")\n    \n    x.Interceptor(len(msg) > 0, x.ERR_PARAMS, "msg")\n    x.Interceptor(false, common.ERR_PASSWORD)\n    \n    x.Println(111, this.GetCtx("guid"))\n    x.Println(111, this.GetCtx("guid"))\n    x.Println(this.JsonForm)\n    x.Println(this.GetRequestBody())\n    \n    this.Render(x.MAP{\n        "msg":      msg,\n        "testmap": x.MAP{\n            "key1": "value1",\n            "key2": 123,\n        },\n        "time":      x.Now(),\n    })\n}\n\nfunc (this *TestController) Hello2Action() {\n    content := this.GetParam("content")\n    x.Println(999, x.MapToString(this.JsonForm))\n    \n    this.RenderText(content)\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"139-\u6570\u636e\u5904\u7406\u51fd\u6570",children:"13.9 \u6570\u636e\u5904\u7406\u51fd\u6570"}),"\n",(0,r.jsx)(e.h3,{id:"1391-json-\u5904\u7406",children:"13.9.1 JSON \u5904\u7406"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// JSON \u7f16\u7801\nx.JsonEncode(v interface{}) string\n\n// JSON \u89e3\u7801\nx.JsonDecode(s string) (interface{}, error)\n\n// \u5b9e\u9645\u5e94\u7528\nfunc (this *Auth) Login(user_id int, user_name string, extends ...map[string]any) {\n    check_ip := "N"\n    extend := ""\n    if len(extends) > 0 && len(extends[0]) > 0 {\n        extend = x.JsonEncode(extends[0])\n    }\n    session_id := this.initLogin(x.AsString(user_id), user_name, extend, check_ip, "N", 0)\n    this.session.Register(session_id)\n}\n\n// \u5728\u7528\u6237\u4fe1\u606f\u89e3\u6790\u4e2d\u4f7f\u7528\nfunc (this *Auth) GetUserInfo() map[string]any {\n    if nil == this.userInfo || len(this.userInfo) == 0 {\n        userstr := this.GetCookie("U", true)\n        if "" != userstr {\n            loginuser, _ := url.ParseQuery(userstr)\n            this.userInfo["user_id"] = this.getQueryValue(loginuser, "i")\n            this.userInfo["user_name"] = this.getQueryValue(loginuser, "n")\n            this.userInfo["session_id"] = this.getQueryValue(loginuser, "o")\n\n            d := this.getQueryValue(loginuser, "d")\n            if "" != d {\n                extend := x.JsonDecode(d)\n                if extend_data, ok := extend.(map[string]any); ok {\n                    for k, v := range extend_data {\n                        this.userInfo[k] = v\n                    }\n                }\n            }\n        }\n    }\n\n    return this.userInfo\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"1392-\u54c8\u5e0c\u548c\u52a0\u5bc6",children:"13.9.2 \u54c8\u5e0c\u548c\u52a0\u5bc6"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// MD5 \u54c8\u5e0c\nx.MD5(s string) string\n\n// \u5b9e\u9645\u5e94\u7528\nfunc (this *Auth) initLogin(user_id, user_name, extend, check_ip, public_place string, login_time int) string {\n    // ... \u5176\u4ed6\u4ee3\u7801 ...\n    \n    session_id := x.MD5(user_id + login_time_str)\n    uc.Add("o", session_id)\n    \n    ucstr := uc.Encode()\n    \n    conf := this.getCookieConfig()\n    expire := 0\n    if "Y" == public_place {\n        expire = x.AsInt(conf["expire"])\n    } else {\n        expire = x.AsInt(conf["expire_lan"])\n    }\n    \n    sc := url.Values{}\n    e := x.AsString(x.Now() + expire)\n    sc.Add("e", e)\n    sc.Add("s", x.MD5(x.AsString(conf["secret"])+ucstr+e))\n    scstr := sc.Encode()\n    \n    // ... \u8bbe\u7f6e Cookie ...\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"1393-ip-\u5730\u5740\u5904\u7406",children:"13.9.3 IP \u5730\u5740\u5904\u7406"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// IP \u8f6c\u957f\u6574\u578b\nx.Ip2long(ip string) int64\n\n// \u5b9e\u9645\u5e94\u7528\nfunc (this *Auth) initLogin(user_id, user_name, extend, check_ip, public_place string, login_time int) string {\n    uc := url.Values{}\n    uc.Add("i", user_id)\n    uc.Add("n", user_name)\n    uc.Add("c", check_ip)\n    uc.Add("b", public_place)\n    uc.Add("p", x.AsString(x.Ip2long(x.GetHttpIp(this.r))))\n    // ... \u5176\u4ed6\u4ee3\u7801 ...\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"1310-http\u5ba2\u6237\u7aef\u5de5\u5177",children:"13.10 HTTP\u5ba2\u6237\u7aef\u5de5\u5177"}),"\n",(0,r.jsx)(e.h3,{id:"13101-http\u5ba2\u6237\u7aef\u521d\u59cb\u5316",children:"13.10.1 HTTP\u5ba2\u6237\u7aef\u521d\u59cb\u5316"}),"\n",(0,r.jsx)(e.p,{children:"x\u5305\u63d0\u4f9b\u4e86\u4fbf\u6377\u7684HTTP\u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u7528\u4e8e\u53d1\u8d77HTTP\u8bf7\u6c42\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u521b\u5efaHTTP\u5ba2\u6237\u7aef\nx.NewHttpClient(config x.MAP) *HttpClient\n\n// \u5b9e\u9645\u5e94\u7528\u793a\u4f8b\nfunc (this *UserSvc) CallExternalAPI(userID int) (x.MAP, error) {\n    config := x.MAP{\n        "timeout":     30,\n        "user_agent":  "Nyx-Framework/1.0",\n        "headers": x.MAP{\n            "Authorization": "Bearer token123",\n            "Content-Type": "application/json",\n        },\n    }\n    \n    client := x.NewHttpClient(config)\n    \n    // GET\u8bf7\u6c42\n    response, err := client.Get("https://api.example.com/user/" + x.AsString(userID))\n    if err != nil {\n        return nil, err\n    }\n    \n    return response.Data, nil\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"13102-http\u8bf7\u6c42\u65b9\u6cd5",children:"13.10.2 HTTP\u8bf7\u6c42\u65b9\u6cd5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// GET\u8bf7\u6c42\nclient.Get(url string) *HttpResponse\n\n// POST\u8bf7\u6c42\nclient.Post(url string, data interface{}) *HttpResponse\n\n// PUT\u8bf7\u6c42\nclient.Put(url string, data interface{}) *HttpResponse\n\n// DELETE\u8bf7\u6c42\nclient.Delete(url string) *HttpResponse\n\n// \u5b9e\u9645\u5e94\u7528\u793a\u4f8b\nfunc (this *AuthSvc) LoginWithAPI(username, password string) error {\n    config := x.Conf.GetStringMap("api_client")\n    client := x.NewHttpClient(config)\n    \n    // POST\u767b\u5f55\u8bf7\u6c42\n    loginData := x.MAP{\n        "username": username,\n        "password": password,\n    }\n    \n    response := client.Post("/api/v1/auth/login", loginData)\n    x.Interceptor(response.StatusCode == 200, x.ERR_OTHER, "\u767b\u5f55\u5931\u8d25")\n    \n    // \u5904\u7406\u54cd\u5e94\u6570\u636e\n    token := x.AsString(response.Data["token"])\n    this.SaveToken(token)\n    \n    return nil\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"13103-\u54cd\u5e94\u5904\u7406",children:"13.10.3 \u54cd\u5e94\u5904\u7406"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// HttpResponse \u7ed3\u6784\ntype HttpResponse struct {\n    StatusCode int\n    Headers    map[string]string\n    Data       x.MAP\n    RawBody    string\n    Error      error\n}\n\n// \u5b9e\u9645\u5e94\u7528\u793a\u4f8b\nfunc (this *OrderSvc) CreateOrder(orderData x.MAP) error {\n    config := x.Conf.GetStringMap("order_api")\n    client := x.NewHttpClient(config)\n    \n    response := client.Post("/api/v1/orders", orderData)\n    \n    // \u68c0\u67e5HTTP\u72b6\u6001\u7801\n    x.Interceptor(response.StatusCode >= 200 && response.StatusCode < 300, x.ERR_OTHER, "\u8ba2\u5355\u521b\u5efa\u5931\u8d25")\n    \n    // \u68c0\u67e5\u4e1a\u52a1\u9519\u8bef\u7801\n    if code, ok := response.Data["code"]; ok {\n        x.Interceptor(x.AsInt(code) == 0, x.ERR_OTHER, response.Data["message"])\n    }\n    \n    // \u63d0\u53d6\u8ba2\u5355\u53f7\n    if orderID, ok := response.Data["order_id"]; ok {\n        this.SaveOrderID(x.AsString(orderID))\n    }\n    \n    return nil\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"13104-\u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5",children:"13.10.4 \u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u5b9e\u9645\u5e94\u7528\u793a\u4f8b\nfunc (this *PaymentSvc) ProcessPayment(paymentData x.MAP) error {\n    config := x.Conf.GetStringMap("payment_api")\n    client := x.NewHttpClient(config)\n    \n    // \u8bbe\u7f6e\u91cd\u8bd5\u673a\u5236\n    maxRetries := 3\n    for i := 0; i < maxRetries; i++ {\n        response := client.Post("/api/v1/payments", paymentData)\n        \n        // \u68c0\u67e5\u7f51\u7edc\u9519\u8bef\n        if response.Error != nil {\n            if i == maxRetries-1 {\n                return response.Error\n            }\n            time.Sleep(time.Second * time.Duration(i+1))\n            continue\n        }\n        \n        // \u68c0\u67e5HTTP\u72b6\u6001\n        if response.StatusCode == 503 {\n            // \u670d\u52a1\u4e0d\u53ef\u7528\uff0c\u7a0d\u540e\u91cd\u8bd5\n            if i == maxRetries-1 {\n                return x.NewErr(500, "\u670d\u52a1\u6682\u4e0d\u53ef\u7528")\n            }\n            time.Sleep(time.Second * time.Duration(i+1))\n            continue\n        }\n        \n        // \u68c0\u67e5\u4e1a\u52a1\u54cd\u5e94\n        if response.StatusCode == 200 {\n            if code, ok := response.Data["code"]; ok && x.AsInt(code) == 0 {\n                return nil\n            } else {\n                return x.NewErr(x.AsInt(response.Data["code"]), x.AsString(response.Data["message"]))\n            }\n        }\n    }\n    \n    return x.NewErr(500, "\u652f\u4ed8\u5904\u7406\u5931\u8d25")\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"1311-\u9ad8\u7ea7\u5de5\u5177\u51fd\u6570",children:"13.11 \u9ad8\u7ea7\u5de5\u5177\u51fd\u6570"}),"\n",(0,r.jsx)(e.h3,{id:"13111-\u81ea\u7531\u6620\u5c04-freemap",children:"13.11.1 \u81ea\u7531\u6620\u5c04 (FreeMap)"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u521b\u5efa\u81ea\u7531\u6620\u5c04\nx.NewFreeMap[K comparable, V any]() *FreeMap[K, V]\n\n// \u5b9e\u9645\u5e94\u7528 - Session \u7ba1\u7406\nvar SessionIds *x.FreeMap[string, int]\n\nfunc init() {\n    SessionIds = x.NewFreeMap[string, int]()\n}\n\nfunc (this *Session) Register(session_id string) {\n    SessionIds.Set(session_id, x.Now())\n    dao.NewSessionDao().AddRecord(x.MAP{"session_id": session_id, "create_at": x.NowTime(), "update_at": x.NowTime()})\n}\n\nfunc (this *Session) Deregister(session_id string) {\n    _, exists := SessionIds.Get(session_id)\n    if exists {\n        SessionIds.Delete(session_id)\n        dao.NewSessionDao().DelRecordBy("session_id = ?", session_id)\n    }\n}\n\nfunc (this *Session) CheckSession(session_id string) bool {\n    update_at, exists := SessionIds.Get(session_id)\n    if !exists {\n        return false\n    }\n\n    // \u8d85\u8fc7 5 \u5206\u949f\u66f4\u65b0\u4e00\u6b21DB\n    if x.Now()-update_at > 10 {\n        SessionIds.Set(session_id, x.Now())\n        dao.NewSessionDao().SetRecordBy(x.MAP{"update_at": x.NowTime()}, "session_id = ?", session_id)\n    }\n\n    return true\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"13112-http-\u4e2d\u95f4\u4ef6",children:"13.11.2 HTTP \u4e2d\u95f4\u4ef6"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"// \u4f7f\u7528 HTTP \u4e2d\u95f4\u4ef6\nx.UseHttpMiddleware(middleware func(next http.Handler) http.Handler)\n\n// \u5b9e\u9645\u5e94\u7528\nfunc main() {\n    n := nyx.NewNyx()\n\n    // \u4f7f\u7528 http middleware \u793a\u4f8b\n    x.UseHttpMiddleware(test)\n\n    err := svc.NewSession().UpdateSessionIds()\n    if err != nil {\n        panic(err)\n    }\n\n    n.Run()\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"13113-\u8d44\u6e90\u5d4c\u5165",children:"13.11.3 \u8d44\u6e90\u5d4c\u5165"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u6a21\u677f\u5d4c\u5165\nx.TemplateEmbed(fs fs.FS, dir string)\n\n// \u9759\u6001\u8d44\u6e90\u5d4c\u5165\nx.StaticEmbed(fs fs.FS, dir string)\n\n// \u5b9e\u9645\u5e94\u7528\nfunc init() {\n    x.TemplateEmbed(embedFS, "templates")\n    x.StaticEmbed(embedFS, "static")\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"1312-\u9519\u8bef\u5904\u7406\u51fd\u6570",children:"13.12 \u9519\u8bef\u5904\u7406\u51fd\u6570"}),"\n",(0,r.jsx)(e.h3,{id:"13121-\u521b\u5efa\u9519\u8bef",children:"13.12.1 \u521b\u5efa\u9519\u8bef"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u521b\u5efa\u591a\u8bed\u8a00\u9519\u8bef\nx.NewErr(code int, langs ...string) error\n\n// \u5b9e\u9645\u5e94\u7528\nvar (\n    ERR_TOKEN    = x.NewErr(106, "CN", "\u8ba4\u8bc1\u5931\u8d25", "EN", "token is invalid")\n    ERR_PASSWORD = x.NewErr(107, "CN", "\u5bc6\u7801\u9519\u8bef", "EN", "password is invalid")\n)\n'})}),"\n",(0,r.jsx)(e.h3,{id:"13122-\u9519\u8bef\u7c7b\u578b\u4f7f\u7528",children:"13.12.2 \u9519\u8bef\u7c7b\u578b\u4f7f\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u5728\u62e6\u622a\u5668\u4e2d\u4f7f\u7528\nx.Interceptor(this.Auth.CheckLogin() || this.ControllerName == "login", common.ERR_TOKEN)\nx.Interceptor(err == nil, common.ERR_PASSWORD)\nx.Interceptor(lib.VerifyPassword(password, userinfo.Password), common.ERR_PASSWORD)\n'})}),"\n",(0,r.jsx)(e.h2,{id:"1313-\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570",children:"13.13 \u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570"}),"\n",(0,r.jsx)(e.h3,{id:"13131-\u5b57\u7b26\u4e32\u8f6c\u6362",children:"13.13.1 \u5b57\u7b26\u4e32\u8f6c\u6362"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// MAP \u8f6c\u5b57\u7b26\u4e32\nx.MapToString(m interface{}) string\n\n// \u5b9e\u9645\u5e94\u7528\nfunc (this *TestController) Hello2Action() {\n    content := this.GetParam("content")\n    x.Println(999, x.MapToString(this.JsonForm))\n    \n    this.RenderText(content)\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"1314-\u5b9e\u9645\u9879\u76ee\u5e94\u7528\u603b\u7ed3",children:"13.14 \u5b9e\u9645\u9879\u76ee\u5e94\u7528\u603b\u7ed3"}),"\n",(0,r.jsx)(e.h3,{id:"13141-\u63a7\u5236\u5668\u5c42\u5e94\u7528",children:"13.14.1 \u63a7\u5236\u5668\u5c42\u5e94\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'func (this *UserController) GetUserListAction() {\n    // \u53c2\u6570\u83b7\u53d6\n    page := this.GetInt("page", 1)\n    num := this.GetInt("num", 50)\n\n    // \u53c2\u6570\u9a8c\u8bc1\u62e6\u622a\u5668\n    x.Interceptor(page > 0, x.ERR_PARAMS, "page")\n    x.Interceptor(num > 0, x.ERR_PARAMS, "num")\n\n    // \u4e1a\u52a1\u903b\u8f91\n    user_svc := svc.NewUserSvc()\n    total, user_list, _ := user_svc.GetUserList(page, num)\n\n    ret_data := x.MAP{\n        "total":     total,\n        "user_list": user_list,\n    }\n\n    this.Render(ret_data)\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"13142-\u670d\u52a1\u5c42\u5e94\u7528",children:"13.14.2 \u670d\u52a1\u5c42\u5e94\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'func (this *UserSvc) AddUser(user_info x.MAP) error {\n    // \u4f7f\u7528 MAP \u7c7b\u578b\n    user_info["create_time"] = x.NowTime()\n    user_info["update_time"] = x.NowTime()\n    \n    user_dao := dao.NewUserDao()\n    return user_dao.AddRecord(user_info)\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"13143-\u6a21\u578b\u5c42\u5e94\u7528",children:"13.14.3 \u6a21\u578b\u5c42\u5e94\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'func NewUserModel(m x.MAP) *UserModel {\n    model := &UserModel{}\n    model.Fill(m)\n    return model\n}\n\nfunc (this *UserModel) Fill(m x.MAP) {\n    if uid, ok := m["uid"]; ok {\n        this.Uid = x.AsInt64(uid)\n    }\n    // ... \u5176\u4ed6\u5b57\u6bb5 ...\n}\n\nfunc (this *UserModel) ToMap() x.MAP {\n    return x.MAP{\n        "uid":         this.Uid,\n        "name":        this.Name,\n        "gender":      this.Gender,\n        "info":        this.Info,\n        "ext":         this.Ext,\n        "status":      this.Status,\n        "create_time": this.CreateTime,\n        "update_time": this.UpdateTime,\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"1315-\u6700\u4f73\u5b9e\u8df5",children:"13.15 \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(e.h3,{id:"13151-\u7c7b\u578b\u8f6c\u6362\u6700\u4f73\u5b9e\u8df5",children:"13.15.1 \u7c7b\u578b\u8f6c\u6362\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u63a8\u8350\uff1a\u4f7f\u7528\u7c7b\u578b\u8f6c\u6362\u51fd\u6570\nuserId := x.AsInt(userInfo["user_id"])\nuserName := x.AsString(userInfo["user_name"])\n\n// \u907f\u514d\uff1a\u76f4\u63a5\u7c7b\u578b\u65ad\u8a00\nuserId := userInfo["user_id"].(int)  // \u53ef\u80fd panic\n'})}),"\n",(0,r.jsx)(e.h3,{id:"13152-\u62e6\u622a\u5668\u4f7f\u7528\u6700\u4f73\u5b9e\u8df5",children:"13.15.2 \u62e6\u622a\u5668\u4f7f\u7528\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u63a8\u8350\uff1a\u53c2\u6570\u9a8c\u8bc1\u5728\u524d\uff0c\u4e1a\u52a1\u903b\u8f91\u5728\u540e\nfunc (this *UserController) AddUserAction() {\n    // 1. \u53c2\u6570\u83b7\u53d6\n    name := this.GetParam("name")\n    \n    // 2. \u53c2\u6570\u9a8c\u8bc1\n    x.Interceptor(name != "", x.ERR_PARAMS, "name")\n    \n    // 3. \u4e1a\u52a1\u903b\u8f91\n    user_svc := svc.NewUserSvc()\n    err := user_svc.AddUser(x.MAP{"name": name})\n    \n    // 4. \u9519\u8bef\u5904\u7406\n    x.Interceptor(err == nil, x.ERR_OTHER, err)\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"1316-\u5c0f\u7ed3",children:"13.16 \u5c0f\u7ed3"}),"\n",(0,r.jsx)(e.p,{children:"x \u5de5\u5177\u51fd\u6570\u662f Nyx \u6846\u67b6\u7684\u6838\u5fc3\u5de5\u5177\u5e93\uff0c\u4e3b\u8981\u5305\u62ec\uff1a"}),"\n",(0,r.jsxs)(e.h3,{id:"-\u6838\u5fc3\u529f\u80fd",children:["\ud83c\udfaf ",(0,r.jsx)(e.strong,{children:"\u6838\u5fc3\u529f\u80fd"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u7c7b\u578b\u8f6c\u6362\u51fd\u6570"}),"\uff1a\u5b89\u5168\u7684\u7c7b\u578b\u8f6c\u6362\u548c\u9ed8\u8ba4\u503c\u5904\u7406"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"MAP \u6570\u636e\u7c7b\u578b"}),"\uff1a\u5f3a\u5927\u7684\u952e\u503c\u5bf9\u5904\u7406\u80fd\u529b"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u62e6\u622a\u5668\u7cfb\u7edf"}),"\uff1a\u7edf\u4e00\u7684\u53c2\u6570\u9a8c\u8bc1\u548c\u4e1a\u52a1\u903b\u8f91\u68c0\u67e5"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u914d\u7f6e\u7ba1\u7406"}),"\uff1a\u4fbf\u6377\u7684\u914d\u7f6e\u8bbf\u95ee\u63a5\u53e3"]}),"\n"]}),"\n",(0,r.jsxs)(e.h3,{id:"\ufe0f-\u5de5\u5177\u5206\u7c7b",children:["\ud83d\udee0\ufe0f ",(0,r.jsx)(e.strong,{children:"\u5de5\u5177\u5206\u7c7b"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u65f6\u95f4\u5de5\u5177"}),"\uff1a",(0,r.jsx)(e.code,{children:"x.Now()"}),"\u3001",(0,r.jsx)(e.code,{children:"x.NowTime()"}),"\u3001",(0,r.jsx)(e.code,{children:"x.DateTime()"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u8def\u7531\u5de5\u5177"}),"\uff1a",(0,r.jsx)(e.code,{children:"x.AddRouteApiFunc()"}),"\u3001",(0,r.jsx)(e.code,{children:"x.AddRouteRpcFunc()"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u8c03\u8bd5\u5de5\u5177"}),"\uff1a",(0,r.jsx)(e.code,{children:"x.Println()"})," \u8c03\u8bd5\u8f93\u51fa"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6570\u636e\u5904\u7406"}),"\uff1a",(0,r.jsx)(e.code,{children:"x.JsonEncode()"}),"\u3001",(0,r.jsx)(e.code,{children:"x.JsonDecode()"}),"\u3001",(0,r.jsx)(e.code,{children:"x.MD5()"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u9ad8\u7ea7\u5de5\u5177"}),"\uff1a",(0,r.jsx)(e.code,{children:"x.FreeMap"}),"\u3001",(0,r.jsx)(e.code,{children:"x.UseHttpMiddleware"}),"\u3001",(0,r.jsx)(e.code,{children:"x.TemplateEmbed()"})]}),"\n"]}),"\n",(0,r.jsxs)(e.h3,{id:"-\u5b9e\u9645\u5e94\u7528",children:["\ud83d\udcbc ",(0,r.jsx)(e.strong,{children:"\u5b9e\u9645\u5e94\u7528"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u63a7\u5236\u5668\u5c42"}),"\uff1a\u53c2\u6570\u9a8c\u8bc1\u3001\u6570\u636e\u5904\u7406\u3001\u54cd\u5e94\u8fd4\u56de"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u670d\u52a1\u5c42"}),"\uff1a\u4e1a\u52a1\u903b\u8f91\u5904\u7406\u3001\u6570\u636e\u8f6c\u6362"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6a21\u578b\u5c42"}),"\uff1a\u6570\u636e\u586b\u5145\u3001\u7c7b\u578b\u8f6c\u6362"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u8ba4\u8bc1\u7cfb\u7edf"}),"\uff1a\u914d\u7f6e\u8bfb\u53d6\u3001\u54c8\u5e0c\u8ba1\u7b97\u3001\u65f6\u95f4\u5904\u7406"]}),"\n"]}),"\n",(0,r.jsxs)(e.h3,{id:"-\u6700\u4f73\u5b9e\u8df5",children:["\ud83d\ude80 ",(0,r.jsx)(e.strong,{children:"\u6700\u4f73\u5b9e\u8df5"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5b89\u5168\u8f6c\u6362"}),"\uff1a\u4f7f\u7528 x \u5305\u63d0\u4f9b\u7684\u7c7b\u578b\u8f6c\u6362\u51fd\u6570"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u53c2\u6570\u9a8c\u8bc1"}),"\uff1a\u5728\u4e1a\u52a1\u903b\u8f91\u524d\u8fdb\u884c\u53c2\u6570\u9a8c\u8bc1"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u9519\u8bef\u5904\u7406"}),"\uff1a\u4f7f\u7528\u7edf\u4e00\u7684\u9519\u8bef\u7c7b\u578b\u548c\u62e6\u622a\u5668"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4ee3\u7801\u89c4\u8303"}),"\uff1a\u9075\u5faa x \u5305\u7684\u4f7f\u7528\u7ea6\u5b9a"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"x \u5de5\u5177\u51fd\u6570\u8d2f\u7a7f\u4e8e Nyx \u6846\u67b6\u7684\u5404\u4e2a\u5c42\u9762\uff0c\u638c\u63e1\u8fd9\u4e9b\u5de5\u5177\u51fd\u6570\u7684\u4f7f\u7528\u65b9\u6cd5\u662f\u719f\u7ec3\u4f7f\u7528 Nyx \u6846\u67b6\u7684\u57fa\u7840\u3002"}),"\n",(0,r.jsx)(e.hr,{})]})}function x(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(a,{...n})}):a(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>l,x:()=>o});var i=s(6540);const r={},t=i.createContext(r);function l(n){const e=i.useContext(t);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:l(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);